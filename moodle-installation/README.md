# Moodle Installation Scripts

## –û–ø–∏—Å–∞–Ω–∏–µ
–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Moodle 5.0+ –Ω–∞ Ubuntu 24.04 —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏ –¥–ª—è RTTI.

**‚úÖ –ù–æ–≤–æ–µ –≤ —Å–µ–Ω—Ç—è–±—Ä–µ 2025:** –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è JavaScript/CSS, CSP, PHP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ—Å–Ω–æ–≤–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É! –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ fix-—Å–∫—Ä–∏–ø—Ç—ã.

## üöÄ QUICK_INSTALL
```bash
# –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –∑–∞–º–µ–Ω–æ–π —Ñ–∞–π–ª–æ–≤ (–æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π)
rm -rf LMS_Drupal 2>/dev/null || true
git clone https://github.com/cheptura/LMS_Drupal.git
cd LMS_Drupal/moodle-installation
sudo chmod +x install-moodle.sh && sudo ./install-moodle.sh
```

### üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
```bash
# –ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —É–∂–µ —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω
cd /tmp/LMS_Drupal
git reset --hard HEAD
git pull --force origin main
cd moodle-installation
sudo chmod +x *.sh
```

## –°–æ—Å—Ç–∞–≤ —Å–∫—Ä–∏–ø—Ç–æ–≤

### üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
1. **01-prepare-system.sh** - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã Ubuntu + –±–∞–∑–æ–≤—ã–π firewall
2. **02-install-webserver.sh** - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx + PHP 8.3 + —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è + CSP + –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
3. **03-install-database.sh** - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL 16 –°–£–ë–î
4. **04-install-cache.sh** - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Redis
5. **05-configure-ssl.sh** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ + CSP + –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ font.php/image.php
6. **06-download-moodle.sh** - –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ Moodle 5.0
7. **07-configure-moodle.sh** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Moodle
8. **08-install-moodle.sh** - –£–º–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Moodle (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å PHP, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Å–∏—Ç—É–∞—Ü–∏–∏)
9. **09-post-install.sh** - –ü–æ—Å—Ç-—É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
10. **10-security.sh** - üõ°Ô∏è **–ù–û–í–û–ï**: –£–≥–ª—É–±–ª–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Fail2Ban, Rate Limiting, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
11. **11-final-check.sh** - –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:
- **update-moodle.sh** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Moodle –¥–æ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π
- **backup-moodle.sh** - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
- **restore-moodle.sh** - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
- **diagnose-moodle.sh** - –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã Moodle
- **fix-permissions.sh** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
- **fix-config-issues.sh** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### üÜò Emergency —É—Ç–∏–ª–∏—Ç—ã (–¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏–π):
- **manage-cron.sh** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –∑–∞–¥–∞—á Moodle (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞, –∑–∞–ø—É—Å–∫, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞)

### üìã –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:
- **install-moodle.sh** - –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## –ü–æ—ç—Ç–∞–ø–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å –∑–∞–º–µ–Ω–æ–π —Ñ–∞–π–ª–æ–≤
rm -rf LMS_Drupal 2>/dev/null || true
git clone https://github.com/cheptura/LMS_Drupal.git
cd LMS_Drupal/moodle-installation
sudo chmod +x *.sh

# –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
sudo ./01-prepare-system.sh      # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã Ubuntu + firewall
sudo ./02-install-webserver.sh   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx –∏ PHP 8.3
sudo ./03-install-database.sh    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL 16
sudo ./04-install-cache.sh       # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Redis
sudo ./05-configure-ssl.sh       # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
sudo ./06-download-moodle.sh     # –ó–∞–≥—Ä—É–∑–∫–∞ Moodle 5.0
sudo ./07-configure-moodle.sh    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Moodle
sudo ./08-install-moodle.sh      # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Moodle –≤ —Å–∏—Å—Ç–µ–º—É
sudo ./09-post-install.sh        # –ü–æ—Å—Ç-—É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
sudo ./10-security.sh            # üõ°Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
sudo ./11-final-check.sh         # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
```

## –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

### üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```bash
sudo ./diagnose-moodle.sh  # –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
systemctl status nginx postgresql php8.3-fpm  # –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
```

### üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
sudo ./backup-moodle.sh    # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞
# –ë—ç–∫–∞–ø—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ /var/backups/moodle/
```

### üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```bash
sudo ./update-moodle.sh    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ Moodle
```

### üîß –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
sudo ./restore-moodle.sh /path/to/backup.tar.gz  # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ú–µ—Ä—ã –∑–∞—â–∏—Ç—ã (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è):

#### üî• –ë–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞ (01-prepare-system.sh):
- **UFW Firewall** - –±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø–æ—Ä—Ç–æ–≤ 22, 80, 443
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** 
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤**

#### üåê –í–µ–±-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (02-install-webserver.sh, 05-configure-ssl.sh):
- **Content Security Policy (CSP)** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π YUI framework
- **HSTS –∑–∞–≥–æ–ª–æ–≤–∫–∏** –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ HTTPS
- **Security Headers** (X-Frame-Options, X-XSS-Protection, X-Content-Type-Options)
- **–°–∫—Ä—ã—Ç–∏–µ –≤–µ—Ä—Å–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞**

#### üõ°Ô∏è –£–≥–ª—É–±–ª–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ (10-security.sh):
- **Fail2Ban** - –∑–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫ –ø–µ—Ä–µ–±–æ—Ä–∞ (brute force)
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –≤ Moodle
  - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö IP
  - –ó–∞—â–∏—Ç–∞ –æ—Ç bot-–∞—Ç–∞–∫
- **Rate Limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ª–æ–≥–∏–Ω—É (5/–º–∏–Ω—É—Ç—É)
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤ (30/–º–∏–Ω—É—Ç—É)
  - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞ IP (25 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- **PHP Hardening** - —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ PHP
  - –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
  - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
  - –°–∫—Ä—ã—Ç–∏–µ –≤–µ—Ä—Å–∏–∏ PHP
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–∏—Å—Ç–µ–º—ã

### üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Fail2Ban
sudo fail2ban-client status

# –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP (–µ—Å–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–æ –æ—à–∏–±–∫–µ)
sudo fail2ban-client set moodle-auth unbanip –í–êSH_IP

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
sudo tail -f /var/log/moodle-security.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞
sudo ufw status verbose

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö IP
sudo fail2ban-client status moodle-auth
```

### üìä –§–∞–π–ª—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- **–õ–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** `/var/log/moodle-security.log`
- **–õ–æ–≥–∏ Nginx:** `/var/log/nginx/security.log`
- **–õ–æ–≥–∏ Fail2Ban:** `/var/log/fail2ban.log`
- **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π:** `/root/security-backup-YYYYMMDD/`

## –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- ‚úÖ **–û–°:** Ubuntu 24.04 LTS
- ‚úÖ **RAM:** –ú–∏–Ω–∏–º—É–º 4GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 8GB)
- ‚úÖ **–î–∏—Å–∫:** 20GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 50GB)
- ‚úÖ **–°–µ—Ç—å:** –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
- ‚úÖ **–ü—Ä–∞–≤–∞:** root –∏–ª–∏ sudo –¥–æ—Å—Ç—É–ø

## –°–µ—Ç–µ–≤—ã–µ –ø–æ—Ä—Ç—ã
- **80** - HTTP (–≤–µ–±-—Å–µ—Ä–≤–µ—Ä)
- **443** - HTTPS (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä)
- **5432** - PostgreSQL (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- **9000** - PHP-FPM (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)

## –î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ

### üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Moodle:
- **HTTP:** http://–≤–∞—à-ip-–∞–¥—Ä–µ—Å
- **HTTPS:** https://–≤–∞—à-–¥–æ–º–µ–Ω (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL)

### üîë –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- –î–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `/var/log/moodle-install.log`

### üìÅ –í–∞–∂–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
- **–ö–æ–¥ Moodle:** `/var/www/moodle` (–Ω–æ–≤—ã–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏) –∏–ª–∏ `/var/www/html/moodle` (—Å—Ç–∞—Ä—ã–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏)
- **–î–∞–Ω–Ω—ã–µ:** `/var/moodledata`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `/var/www/moodle/config.php`
- **–õ–æ–≥–∏ Nginx:** `/var/log/nginx/`
- **–õ–æ–≥–∏ PHP:** `/var/log/php8.3-fpm.log`

## üì¶ PHP 8.3 –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

### ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è):
- **ctype** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **curl** - HTTP –∫–ª–∏–µ–Ω—Ç (php8.3-curl)
- **dom** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ php8.3-xml
- **gd** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (php8.3-gd)
- **iconv** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **intl** - –ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è (php8.3-intl)
- **json** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **mbstring** - –ú–Ω–æ–≥–æ–±–∞–π—Ç–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ (php8.3-mbstring)
- **pcre** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **simplexml** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ php8.3-xml
- **spl** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **xml** - XML –ø–∞—Ä—Å–µ—Ä (php8.3-xml)
- **zip** - –†–∞–±–æ—Ç–∞ —Å –∞—Ä—Ö–∏–≤–∞–º–∏ (php8.3-zip)
- **pgsql** - PostgreSQL –¥—Ä–∞–π–≤–µ—Ä (php8.3-pgsql)

### üîß –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:
- **openssl** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **soap** - Web services (php8.3-soap)
- **sodium** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3 (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è)
- **tokenizer** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **xmlrpc** - XML-RPC –ø—Ä–æ—Ç–æ–∫–æ–ª (php8.3-xmlrpc)
- **ldap** - LDAP –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (php8.3-ldap)
- **redis** - Redis –∫—ç—à (php8.3-redis)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ troubleshooting

### üö® –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

#### –û—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx (–Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è)
```bash
# ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: Nginx –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–ª–∏ –ø–∞–¥–∞–µ—Ç –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è:
# - "nginx: configuration file /etc/nginx/nginx.conf test failed"
# - "nginx.service failed with result 'exit-code'"
# - –û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ nginx -t

# üéØ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:
sudo nginx -t
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω—É—é –æ—à–∏–±–∫—É –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

# üìã –û–°–ù–û–í–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø:

# 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ log_format:
# –ü—Ä–æ–±–ª–µ–º–∞: log_format security –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
grep -n "log_format security" /etc/nginx/nginx.conf
# –†–µ—à–µ–Ω–∏–µ: –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ http –±–ª–æ–∫–µ

# 2. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ limit_req_zone:
# –ü—Ä–æ–±–ª–µ–º–∞: "is already bound to key" - –∑–æ–Ω—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–≤–∞–∂–¥—ã
grep -r "limit_req_zone.*login" /etc/nginx/
# –†–µ—à–µ–Ω–∏–µ: –£–¥–∞–ª–∏—Ç—å –∏–∑ conf.d, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ nginx.conf

# 3. –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã more_*_headers:
# –ü—Ä–æ–±–ª–µ–º–∞: "unknown directive more_clear_headers"
find /etc/nginx/conf.d/ -name "*.conf" -exec grep -l "more_" {} \;
# –†–µ—à–µ–Ω–∏–µ: –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã —Å more_* –¥–∏—Ä–µ–∫—Ç–∏–≤–∞–º–∏

# 4. location –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ:
# –ü—Ä–æ–±–ª–µ–º–∞: "location directive is not allowed here"
grep -r "location " /etc/nginx/conf.d/
# –†–µ—à–µ–Ω–∏–µ: –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å location –±–ª–æ–∫–∏ –≤ server —Å–µ–∫—Ü–∏—é

# üîß –≠–ö–°–¢–†–ï–ù–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Nginx:
sudo systemctl stop nginx

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
sudo nginx -t

# 3. –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ñ–∞–π–ª—ã:
sudo rm -f /etc/nginx/conf.d/security-headers.conf
sudo rm -f /etc/nginx/conf.d/rate-limiting.conf
sudo rm -f /etc/nginx/conf.d/ddos-protection.conf

# 4. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
sudo cp /etc/nginx/nginx.conf.backup* /etc/nginx/nginx.conf 2>/dev/null || true

# 5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å:
sudo nginx -t && sudo systemctl start nginx

# üö® –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï:
# –ï—Å–ª–∏ Nginx –≤–æ–æ–±—â–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
sudo systemctl stop nginx
sudo mv /etc/nginx/nginx.conf /etc/nginx/nginx.conf.broken
sudo nginx -T > /tmp/default-nginx.conf 2>/dev/null || curl -s https://raw.githubusercontent.com/nginx/nginx/master/conf/nginx.conf > /tmp/default-nginx.conf
sudo cp /tmp/default-nginx.conf /etc/nginx/nginx.conf
sudo nginx -t && sudo systemctl start nginx

# üìä –õ–û–ì–ò –î–õ–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò:
sudo journalctl -u nginx -f --no-pager
sudo tail -f /var/log/nginx/error.log

# ‚ÑπÔ∏è –ö–û–†–ù–ï–í–´–ï –ü–†–ò–ß–ò–ù–´:
# –°–∫—Ä–∏–ø—Ç 10-security.sh –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
# –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º: sudo nginx -t
```

#### –û—à–∏–±–∫–∞ "Call to undefined function curl_exec()"
```bash
# ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: Exception - Call to undefined function curl_exec()
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —è–∑—ã–∫–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö, –≤–µ–±-—Å–µ—Ä–≤–∏—Å–∞—Ö
# –ü—Ä–∏—á–∏–Ω–∞: –§—É–Ω–∫—Ü–∏–∏ cURL –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –≤ disable_functions —Ñ–∞–π–ª–∞ 99-security.ini

# üéØ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –†–ï–®–ï–ù–ò–ï: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ—Å—Ç-—É—Å—Ç–∞–Ω–æ–≤–∫—É
cd /–ø—É—Ç—å/–∫/moodle-installation
sudo ./09-post-install.sh

# –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# - –û–±–Ω–∞—Ä—É–∂–∏—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É curl_exec –≤ disable_functions
# - –ò—Å–ø—Ä–∞–≤–∏—Ç —Ñ–∞–π–ª—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Å —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏)
# - –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç cURL –º–æ–¥—É–ª—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
# - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å —Ä–µ–∞–ª—å–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º

# üéØ –≠–ö–°–¢–†–ï–ù–ù–û–ï –†–£–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:
# 1. –ù–∞–π—Ç–∏ —Ñ–∞–π–ª—ã —Å –ø—Ä–æ–±–ª–µ–º–æ–π:
grep -r "disable_functions.*curl_exec" /etc/php/8.3/

# 2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å 99-security.ini:
sudo sed -i 's/disable_functions = \(.*\),curl_exec,curl_multi_exec,\(.*\)/disable_functions = \1,\2/' /etc/php/8.3/fpm/conf.d/99-security.ini
sudo sed -i 's/disable_functions = \(.*\),curl_exec,\(.*\)/disable_functions = \1,\2/' /etc/php/8.3/fpm/conf.d/99-security.ini

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å PHP-FPM:
sudo systemctl restart php8.3-fpm

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
php-fpm8.3 -i | grep "disable_functions"

# ‚ÑπÔ∏è –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê: 
# –°–∫—Ä–∏–ø—Ç 10-security.sh —Å–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª 99-security.ini —Å disable_functions,
# –∫–æ—Ç–æ—Ä—ã–π –±–ª–æ–∫–∏—Ä—É–µ—Ç curl_exec. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤!

# ‚úÖ –ü–†–ï–í–ï–ù–¢–ò–í–ù–ê–Ø –ú–ï–†–ê:
# –í –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞ 10-security.sh curl_exec –∏—Å–∫–ª—é—á–µ–Ω
# –∏–∑ disable_functions, —Ç–∞–∫ –∫–∞–∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω –¥–ª—è Moodle

# üîß –ï–°–õ–ò –û–®–ò–ë–ö–ê –û–°–¢–ê–ï–¢–°–Ø –í –í–ï–ë-–ò–ù–¢–ï–†–§–ï–ô–°–ï:
# –ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ç–æ–º, —á—Ç–æ cURL —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ CLI, –Ω–æ –Ω–µ –≤ PHP-FPM (–≤–µ–±-–≤–µ—Ä—Å–∏–∏)
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
sudo apt install -y --reinstall php8.3-curl
echo "extension=curl" | sudo tee -a /etc/php/8.3/fpm/php.ini
sudo systemctl restart php8.3-fpm nginx

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –≤–µ–± (—Å–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª):
# echo '<?php echo function_exists("curl_exec") ? "cURL OK" : "cURL FAIL"; ?>' | sudo tee /var/www/moodle/curl-test.php
# –û—Ç–∫—Ä–æ–π—Ç–µ: https://–≤–∞—à-–¥–æ–º–µ–Ω/curl-test.php
# –£–¥–∞–ª–∏—Ç–µ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏: sudo rm /var/www/moodle/curl-test.php
```

#### –û—à–∏–±–∫–∞ 404 –¥–ª—è PHP —Ñ–∞–π–ª–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ (langimport, tool –∏ –¥—Ä.)
```bash
# ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: GET /admin/tool/langimport/index.php 404 (Not Found)
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: 404 –æ—à–∏–±–∫–∏ –¥–ª—è PHP —Ñ–∞–π–ª–æ–≤ –≤ –ø–∞–ø–∫–∞—Ö /admin/tool/, /admin/settings/ –∏ –¥—Ä.
# –ü—Ä–∏—á–∏–Ω–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PHP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤ Nginx

# üéØ –†–ï–®–ï–ù–ò–ï: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
cd /–ø—É—Ç—å/–∫/moodle-installation
sudo ./10-security.sh

# –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç PHP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—É—Ç–µ–π

# üéØ –†–£–ß–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx:
sudo nginx -t
# –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞, –∏—Å–ø—Ä–∞–≤–∏—Ç–µ –∏—Ö –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
sudo systemctl reload nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π PHP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤ /etc/nginx/sites-available/–≤–∞—à-—Å–∞–π—Ç:
# location ~ [^/]\.php(/|$) {
#     fastcgi_split_path_info ^(.+\.php)(/.+)$;
#     ...
# }
```

#### –û—à–∏–±–∫–∞ "unknown directive more_clear_headers"
```bash
# ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: nginx: unknown directive "more_clear_headers" in /etc/nginx/conf.d/security-headers.conf
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: nginx: configuration file /etc/nginx/nginx.conf test failed
# –ü—Ä–∏—á–∏–Ω–∞: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∞, –∫–æ—Ç–æ—Ä–∞—è —Ç—Ä–µ–±—É–µ—Ç –º–æ–¥—É–ª—å nginx-module-headers-more

# üéØ –†–ï–®–ï–ù–ò–ï: –£–¥–∞–ª–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo rm -f /etc/nginx/conf.d/security-headers.conf
sudo rm -f /etc/nginx/conf.d/headers-more.conf
sudo nginx -t && sudo systemctl reload nginx

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
cd /–ø—É—Ç—å/–∫/moodle-installation
sudo ./10-security.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞: sudo nginx -t –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å "syntax is ok"
```

#### –Ø–∑—ã–∫–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ Moodle
```bash
# ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: "Invalid current value: ru" –∏–ª–∏ —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
# –ü—Ä–∏—á–∏–Ω–∞: –Ø–∑—ã–∫–æ–≤–æ–π –ø–∞–∫–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å cURL

# üéØ –†–ï–®–ï–ù–ò–ï: –ü–æ—Å—Ç-—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —è–∑—ã–∫–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã
cd /–ø—É—Ç—å/–∫/moodle-installation
sudo ./09-post-install.sh

# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏:
# - –ê–Ω–≥–ª–∏–π—Å–∫–∏–π (en) - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π
# - –†—É—Å—Å–∫–∏–π (ru) - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
# - –¢–∞–¥–∂–∏–∫—Å–∫–∏–π (tg) - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞ > –Ø–∑—ã–∫ > –Ø–∑—ã–∫–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã > Russian (ru) / Tajik (tg) > –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
```

#### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "hard-set in the config.php, unable to change"
```bash
# ‚úÖ –≠—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
# –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∑–∞–¥–∞–Ω—ã –≤ —Ñ–∞–π–ª–µ config.php - —ç—Ç–æ –ù–û–†–ú–ê–õ–¨–ù–û!

# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: "The configuration variable is hard-set in the config.php"
# –ü—Ä–∏—á–∏–Ω–∞: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–¥–∞—é—Ç—Å—è –≤ config.php –∏ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

# üéØ –†–ï–®–ï–ù–ò–ï: –≠—Ç–æ –ù–ï –æ—à–∏–±–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ!
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–¥–∞–Ω—ã –≤ config.php

# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
sudo nano /var/www/moodle/config.php

# –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Ç–∏–ø–∞:
# $CFG->theme = 'boost';
# $CFG->enablecompletion = 1;

# –ò –∏–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å Moodle Cron (–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
```bash
# –ï—Å–ª–∏ cron —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ –∏ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: "Continuing to check for tasks for XXX more seconds"
# –ò–õ–ò: "Execute scheduled task: Cleanup old sessions" –∏ –∑–∞–≤–∏—Å–∞–µ—Ç

# –ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï (–≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):
sudo pkill -f "cron.php"
sudo pkill -9 -f "cron.php"

# –†–µ—à–µ–Ω–∏–µ 1: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Ç–∏–ª–∏—Ç—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è cron:
sudo chmod +x manage-cron.sh && sudo ./manage-cron.sh
# –í –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ:
# 3) –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ cron –ø—Ä–æ—Ü–µ—Å—Å—ã
# 1) –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π cron (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

# –†–µ—à–µ–Ω–∏–µ 2: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä—É—á–Ω—É—é
# –ù–∞–π—Ç–∏ –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã cron:
ps aux | grep cron.php

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã (–∑–∞–º–µ–Ω–∏—Ç–µ PID –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞):
sudo kill [PID1] [PID2] ...

# –ò–ª–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ:
sudo pkill -f cron.php

# –†–µ—à–µ–Ω–∏–µ 3: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ cron
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª /etc/cron.d/moodle:
sudo nano /etc/cron.d/moodle

# –î–æ–±–∞–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# * * * * * www-data /usr/bin/php /var/www/moodle/admin/cli/cron.php --quiet >/dev/null 2>&1

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å cron —Å–ª—É–∂–±—É:
sudo systemctl restart cron

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
sudo systemctl status cron
```

#### –û—à–∏–±–∫–∞ "max_input_vars –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 5000"
```bash
# –≠—Ç–∞ –æ—à–∏–±–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Moodle, –µ—Å–ª–∏ PHP –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: "max_input_vars !! [–°–∏—Å—Ç–µ–º–∞] —ç—Ç–æ—Ç —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ–π–¥–µ–Ω"

# –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é
sudo nano /etc/php/8.3/fpm/php.ini
# –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É max_input_vars –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
# max_input_vars = 5000

sudo nano /etc/php/8.3/cli/php.ini  
# –¢–æ–∂–µ —Å–∞–º–æ–µ –¥–ª—è CLI –≤–µ—Ä—Å–∏–∏

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PHP-FPM:
sudo systemctl restart php8.3-fpm

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É:
php -r "echo 'max_input_vars = ' . ini_get('max_input_vars') . PHP_EOL;"
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: max_input_vars = 5000
```

#### –û—à–∏–±–∫–∞ "Command line scripts must define CLI_SCRIPT"
```bash
# ‚úÖ –≠—Ç–∞ –æ—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö –≤–µ—Ä—Å–∏–∏ 2.0+
# –ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ —ç—Ç—É –æ—à–∏–±–∫—É –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ 09-post-install.sh
# –°–∫—Ä–∏–ø—Ç —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä—É—á–Ω—É—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ:
sudo -u postgres psql -d moodle -c "SELECT version();"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Redis:
redis-cli ping
```

#### –ü—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ config.php (Moodle 5.0+)
```bash
# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –≤–µ—Ä—Å–∏–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ 2.0+
# –ù–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è Moodle 5.0:

# 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ routerconfigured
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Ä–æ—É—Ç–µ—Ä–µ –≤ –ª–æ–≥–∞—Ö
# –†–µ—à–µ–Ω–∏–µ: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è $CFG->routerconfigured = false;

# 2. –£–±—Ä–∞–Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–ª–ª–∞—Ü–∏—è –¥–ª—è PostgreSQL
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: "dbcollation not supported for pgsql"
# –†–µ—à–µ–Ω–∏–µ: –£–¥–∞–ª–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ 'dbcollation' => 'utf8_unicode_ci' –¥–ª—è PostgreSQL

# 3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
# –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ 02777 –≤–º–µ—Å—Ç–æ 0777 –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

# –ï—Å–ª–∏ —É –≤–∞—Å —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è config.php:
sudo ./07-configure-moodle.sh  # –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç config.php —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

#### –û—à–∏–±–∫–∞ "php8.3-fpm.service not found" –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –≤–µ—Ä—Å–∏—è–º–∏ PHP
```bash
# –ù–û–í–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –£—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å PHP 8.4
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: "database driver problem detected", "PGSQL extension is not loaded"
# –ü—Ä–∏—á–∏–Ω–∞: —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ppa:ondrej/php –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç PHP 8.4

# –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
sudo ./02-install-webserver.sh  # –¢–µ–ø–µ—Ä—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å—Ç–∞–≤–∏—Ç —Ç–æ–ª—å–∫–æ PHP 8.3

# –≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—Å—Ç–∏—Ç –≤—Å–µ –≤–µ—Ä—Å–∏–∏ PHP –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç —Ç–æ–ª—å–∫–æ PHP 8.3
# —Å –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –¥–ª—è Moodle

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏:
php --version                    # –î–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å PHP 8.3.x
dpkg -l | grep php8.3           # –°–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ PHP 8.3
dpkg -l | grep -E "php[0-9]" | grep -v php8.3  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–≥–∏—Ö –≤–µ—Ä—Å–∏–π

# –ò–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤–µ—Ä—Å–∏—é PHP –∏ –∏—Å–ø—Ä–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é:
php --version
sudo systemctl start php8.3-fpm  # –∏–ª–∏ –¥—Ä—É–≥—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é –≤–µ—Ä—Å–∏—é
sudo systemctl enable php8.3-fpm
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ PHP —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –¥–ª—è Moodle
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π:
php -m | grep -E "(curl|gd|intl|mbstring|xml|zip|pgsql|soap|sodium)"

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
php -r "
echo 'PHP Version: ' . phpversion() . PHP_EOL;
echo 'Required extensions:' . PHP_EOL;
\$required = ['curl', 'gd', 'intl', 'mbstring', 'xml', 'zip', 'pgsql'];
foreach (\$required as \$ext) {
    echo \$ext . ': ' . (extension_loaded(\$ext) ? 'OK' : 'MISSING') . PHP_EOL;
}
"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π:
sudo apt install -y php8.3-pgsql php8.3-gd php8.3-curl php8.3-mbstring php8.3-xml php8.3-zip php8.3-intl php8.3-soap
sudo systemctl restart php8.3-fpm
```

#### –û—à–∏–±–∫–∞ "database driver problem detected" (PGSQL extension)
```bash
# –ï—Å–ª–∏ PHP —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:
sudo apt install -y php8.3-pgsql
sudo systemctl restart php8.3-fpm
```

#### –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∞–π–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (install.lock)
```bash
# ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞: "–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞)"
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: –ü—Ä–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ install.lock

# üéØ –†–ï–®–ï–ù–ò–ï: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —É–º–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
sudo ./08-install-moodle.sh

# –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
# 1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
# 2. –ó–∞–≤–µ—Ä—à–∏—Ç –ø—Ä–µ—Ä–≤–∞–Ω–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É
# 3. –°–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª install.lock
# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
# –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:
sudo touch /var/www/moodle/install.lock
sudo chown www-data:www-data /var/www/moodle/install.lock

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
sudo ./diagnose-moodle.sh
```

#### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ (–ù–ï –∫—Ä–∏—Ç–∏—á–Ω—ã–µ)
```bash
# ‚úÖ –≠—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ù–û–†–ú–ê–õ–¨–ù–´ –∏ –ù–ï —Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

# 1. "integer expression expected" 
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: "./08-install-moodle.sh: line 191: [: 0 0: integer expression expected"
# –ü—Ä–∏—á–∏–Ω–∞: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞
# –†–µ—à–µ–Ω–∏–µ: –ò–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ - —ç—Ç–æ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É

# 2. "No upgrade needed for the installed version"
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: "No upgrade needed for the installed version 5.0.2+"
# –ü—Ä–∏—á–∏–Ω–∞: Moodle —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∞–∫—Ç—É–∞–ª–µ–Ω
# –†–µ—à–µ–Ω–∏–µ: –≠—Ç–æ —Ö–æ—Ä–æ—à–æ! –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

# 3. "Cron –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)"
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ cron
# –ü—Ä–∏—á–∏–Ω–∞: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ cron –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
# –†–µ—à–µ–Ω–∏–µ: –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ

# 4. "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–µ –∫—ç—à–∞ (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)"
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –∫—ç—à–∞
# –ü—Ä–∏—á–∏–Ω–∞: –ö—ç—à –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –ø—Ä–∏ –ø–µ—Ä–≤–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ
# –†–µ—à–µ–Ω–∏–µ: –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

# üéØ –í–ê–ñ–ù–û: –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
# "–£–ú–ù–ê–Ø –£–°–¢–ê–ù–û–í–ö–ê MOODLE –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û!" - –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ!
```

#### –ü—Ä–æ–±–ª–µ–º–∞ "Defined in config.php" - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è –≤ –∞–¥–º–∏–Ω–∫–µ
```bash
# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û –≤ –≤–µ—Ä—Å–∏–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ –æ—Ç 6 —Å–µ–Ω—Ç—è–±—Ä—è 2025!
# –¢–µ–ø–µ—Ä—å –≤ config.php –∂–µ—Å—Ç–∫–æ –ø—Ä–æ–ø–∏—Å–∞–Ω—ã —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

# ‚ùå –°—Ç–∞—Ä–∞—è –ø—Ä–æ–±–ª–µ–º–∞: "The setting is defined in config.php, so it cannot be changed"
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: 
# - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
# - –°–µ—Ä—ã–π —Ç–µ–∫—Å—Ç "Defined in config.php" —Ä—è–¥–æ–º —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
# - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è –≤ —Ñ–æ—Ä–º–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫

# –ü—Ä–∏—á–∏–Ω–∞: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–æ –≤ config.php

# üéØ –†–ï–®–ï–ù–ò–ï –≤ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏:
# –í config.php –æ—Å—Ç–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
# - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö ($CFG->dbtype, $CFG->dbhost, etc.)
# - –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º ($CFG->wwwroot, $CFG->dataroot, etc.)
# - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
# - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ($CFG->forcessl, $CFG->cookiesecure)
# - –û—Ç–ª–∞–¥–∫–∞ ($CFG->debug)

# ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –¢–ï–ü–ï–†–¨ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É:
# - –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—Ö–æ–¥ (forcelogin)
# - –ó–∞—â–∏—Ç–∞ –∏–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (protectusernames)
# - –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (lang)
# - –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å (timezone)
# - –¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è (theme)
# - –ü–æ–ª–∏—Ç–∏–∫–∞ –ø–∞—Ä–æ–ª–µ–π (passwordpolicy, minpasswordlength, etc.)
# - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ email (smtphosts, noreplyaddress, etc.)
# - –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (backup_auto_*)
# - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (maxbytes)
# - –ë–ª–æ–≥–∏ –∏ RSS (enableblogs, enablerssfeeds)
# - –ò –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ...

# üìç –ì–¥–µ –Ω–∞–π—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∞–¥–º–∏–Ω–∫–µ:
# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞ ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Üí –ü–æ–ª–∏—Ç–∏–∫–∏ —Å–∞–π—Ç–∞
# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞ ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è
# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞ ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ ‚Üí –¢–µ–º—ã ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã
# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞ ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –°–µ—Ä–≤–µ—Ä ‚Üí Email ‚Üí –ò—Å—Ö–æ–¥—è—â–∞—è –ø–æ—á—Ç–∞

# üîß –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
# 1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å /var/www/moodle/config.php
# 2. –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É: $CFG->–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ = '–∑–Ω–∞—á–µ–Ω–∏–µ';
# 3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª

# ‚öôÔ∏è –ü–µ—Ä–≤–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —á–µ—Ä–µ–∑:
# /root/moodle-initial-settings.sh (—Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ 07-configure-moodle.sh)
```

#### –û—à–∏–±–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è rate limiting –∑–æ–Ω "is already bound to key"
```bash
# ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: limit_req_zone "login" is already bound to key "$binary_remote_addr"
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: 
# - nginx: configuration file /etc/nginx/nginx.conf test failed
# - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–æ–Ω –≤ rate-limiting.conf –∏ nginx.conf
# - –ö–æ–Ω—Ñ–ª–∏–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ rate limiting

# –ü—Ä–∏—á–∏–Ω–∞: Rate limiting –∑–æ–Ω—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–≤–∞–∂–¥—ã

# üîß –†–£–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:
# 1. –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π —Ñ–∞–π–ª:
sudo rm -f /etc/nginx/conf.d/rate-limiting.conf

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–æ–Ω—ã –µ—Å—Ç—å –≤ nginx.conf:
grep "limit_req_zone" /etc/nginx/nginx.conf

# 3. –ï—Å–ª–∏ –∑–æ–Ω –Ω–µ—Ç, –¥–æ–±–∞–≤–∏—Ç—å –≤ http –±–ª–æ–∫ nginx.conf:
sudo nano /etc/nginx/nginx.conf
# –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ "http {":
# limit_req_zone $binary_remote_addr zone=login:10m rate=5r/m;
# limit_req_zone $binary_remote_addr zone=api:10m rate=30r/m;
# limit_req_zone $binary_remote_addr zone=uploads:10m rate=10r/m;
# limit_conn_zone $binary_remote_addr zone=conn_limit_per_ip:10m;

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å:
sudo nginx -t && sudo systemctl reload nginx

# ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: nginx -t –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å "syntax is ok"
```

#### –û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx "location directive is not allowed here"
```bash
# ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: "location directive is not allowed here in /etc/nginx/conf.d/ddos-protection.conf"
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: 
# - nginx: configuration file /etc/nginx/nginx.conf test failed
# - –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
# - –°–∞–π—Ç –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

# –ü—Ä–∏—á–∏–Ω–∞: location –±–ª–æ–∫–∏ —Å–æ–∑–¥–∞–Ω—ã –≤ conf.d —Ñ–∞–π–ª–µ –≤–º–µ—Å—Ç–æ server –±–ª–æ–∫–∞

# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:
sudo rm -f /etc/nginx/conf.d/ddos-protection.conf
sudo nginx -t && sudo systemctl reload nginx

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é —Å–∫—Ä–∏–ø—Ç–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
git pull origin main  # –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é
sudo ./10-security.sh  # –¢–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç DDoS –∑–∞—â–∏—Ç—É
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π JavaScript –∏ CSS —Ñ–∞–π–ª–æ–≤
```bash
# ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: JavaScript –∏ CSS —Ñ–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (–æ—à–∏–±–∫–∏ 404)
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: 
# - "GET /lib/javascript.php/1/lib/javascript-static.js net::ERR_ABORTED 404"
# - "GET /theme/styles.php/boost/xxx/all net::ERR_ABORTED 404"
# - "Uncaught EvalError: Refused to evaluate a string as JavaScript"
# - "Cannot read properties of undefined (reading 'js_pending')"

# üéØ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò –í–ö–õ–Æ–ß–ï–ù–û –≤ scripts 02-install-webserver.sh –∏ 05-configure-ssl.sh
# ‚úÖ CSP —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π 'unsafe-eval' –¥–ª—è YUI framework
# ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ font.php –∏ image.php —Å PATH_INFO
# ‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ JavaScript/CSS handlers
# ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PHP —Å OPcache

# üîß –†–£–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—ã–ª–∞ —Å–¥–µ–ª–∞–Ω–∞ —Å—Ç–∞—Ä—ã–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏):
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É –≤ Nginx:
sudo nano /etc/nginx/sites-available/omuzgorpro.tj
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ root —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ /var/www/moodle (–ù–ï /var/www/html/moodle)

# 2. –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è Moodle —Ñ–∞–π–ª–æ–≤:
# location ~ ^/lib/javascript\.php {
#     include snippets/fastcgi-php.conf;
#     fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;
# }
# 
# location ~ ^/theme/styles\.php {
#     include snippets/fastcgi-php.conf;
#     fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;
# }

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Nginx:
sudo nginx -t && sudo systemctl reload nginx

# 4. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à:
sudo -u www-data php /var/www/moodle/admin/cli/purge_caches.php

# 5. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+F5)

# ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê –° –ö–û–ù–§–õ–ò–ö–¢–£–Æ–©–ò–ú–ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø–ú–ò SSL
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: "conflicting server name omuzgorpro.tj on 0.0.0.0:80, ignored"
# –ü—Ä–∏—á–∏–Ω–∞: –ù–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞

# –†–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π:
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤:
ls -la /etc/nginx/sites-available/ | grep omuzgorpro
ls -la /etc/nginx/sites-enabled/ | grep omuzgorpro

# –£–¥–∞–ª–∏—Ç–µ –¥—É–±–ª–∏–∫–∞—Ç—ã, –æ—Å—Ç–∞–≤–∏–≤ –æ–¥–∏–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

### üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/php8.3-fpm.log
sudo journalctl -u nginx -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl restart nginx
sudo systemctl restart php8.3-fpm
sudo systemctl restart postgresql
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–ø–∞–ø–∫–∞ `monitoring-installation`):
- **Grafana:** http://–≤–∞—à-ip:3000 (admin/admin)
- **Prometheus:** http://–≤–∞—à-ip:9090
- **Alertmanager:** http://–≤–∞—à-ip:9093

## üè¢ RTTI –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **–ü—Ä–æ–µ–∫—Ç:** LMS –¥–ª—è –†–µ—Å–ø—É–±–ª–∏–∫–∞–Ω—Å–∫–æ–≥–æ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –¢–µ—Ö–Ω–∏–∫—É–º–∞ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- **–°–µ—Ä–≤–µ—Ä:** omuzgorpro.tj
- **GitHub:** https://github.com/cheptura/LMS_Drupal
- **–ê–≤—Ç–æ—Ä:** cheptura

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è
–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ RTTI –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.
