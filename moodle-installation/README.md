# Moodle Installation Scripts

## –û–ø–∏—Å–∞–Ω–∏–µ
–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Moodle 5.0+ –Ω–∞ Ubuntu 24.04 —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏ –¥–ª—è RTTI.

## üöÄ QUICK_INSTALL
```bash
# –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –∑–∞–º–µ–Ω–æ–π —Ñ–∞–π–ª–æ–≤ (–æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π)
rm -rf LMS_Drupal 2>/dev/null || true
git clone https://github.com/cheptura/LMS_Drupal.git
cd LMS_Drupal/moodle-installation
sudo chmod +x install-moodle.sh && sudo ./install-moodle.sh
```

### üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
```bash
# –ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —É–∂–µ —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω
cd /tmp/LMS_Drupal
git reset --hard HEAD
git pull --force origin main
cd moodle-installation
sudo chmod +x *.sh
```

## –°–æ—Å—Ç–∞–≤ —Å–∫—Ä–∏–ø—Ç–æ–≤

### üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
1. **01-prepare-system.sh** - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã Ubuntu
2. **02-install-webserver.sh** - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx + PHP 8.3
3. **03-install-database.sh** - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL 16 –°–£–ë–î
4. **04-install-cache.sh** - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Redis
5. **05-configure-ssl.sh** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
6. **06-download-moodle.sh** - –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ Moodle 5.0
7. **07-configure-moodle.sh** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Moodle
8. **08-install-moodle.sh** - –£–º–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Moodle (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Å–∏—Ç—É–∞—Ü–∏–∏)
9. **09-post-install.sh** - –ü–æ—Å—Ç-—É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
10. **10-final-check.sh** - –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:
- **update-moodle.sh** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Moodle –¥–æ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π
- **backup-moodle.sh** - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
- **restore-moodle.sh** - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
- **diagnose-moodle.sh** - –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã Moodle
- **fix-config-issues.sh** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **diagnose-php-fpm.sh** - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ PHP-FPM
- **fix-php-versions.sh** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –≤–µ—Ä—Å–∏—è–º–∏ PHP (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ PHP 8.3)
- **fix-php-config.sh** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ PHP –¥–ª—è Moodle (max_input_vars, –ø–∞–º—è—Ç—å –∏ —Ç.–¥.)
- **manage-cron.sh** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –∑–∞–¥–∞—á Moodle (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞, –∑–∞–ø—É—Å–∫, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞)

### üìã –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:
- **install-moodle.sh** - –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## –ü–æ—ç—Ç–∞–ø–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å –∑–∞–º–µ–Ω–æ–π —Ñ–∞–π–ª–æ–≤
rm -rf LMS_Drupal 2>/dev/null || true
git clone https://github.com/cheptura/LMS_Drupal.git
cd LMS_Drupal/moodle-installation
sudo chmod +x *.sh

# –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
sudo ./01-prepare-system.sh      # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã Ubuntu
sudo ./02-install-webserver.sh   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx –∏ PHP 8.3
sudo ./03-install-database.sh    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL 16
sudo ./04-install-cache.sh       # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Redis
sudo ./05-configure-ssl.sh       # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
sudo ./06-download-moodle.sh     # –ó–∞–≥—Ä—É–∑–∫–∞ Moodle 5.0
sudo ./07-configure-moodle.sh    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Moodle
sudo ./08-install-moodle.sh      # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Moodle –≤ —Å–∏—Å—Ç–µ–º—É
sudo ./09-post-install.sh        # –ü–æ—Å—Ç-—É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
sudo ./10-final-check.sh         # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
```

## –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

### üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```bash
sudo ./diagnose-moodle.sh  # –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
systemctl status nginx postgresql php8.3-fpm  # –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
```

### üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
sudo ./backup-moodle.sh    # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞
# –ë—ç–∫–∞–ø—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ /var/backups/moodle/
```

### üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```bash
sudo ./update-moodle.sh    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ Moodle
```

### üîß –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
sudo ./restore-moodle.sh /path/to/backup.tar.gz  # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
```

## –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- ‚úÖ **–û–°:** Ubuntu 24.04 LTS
- ‚úÖ **RAM:** –ú–∏–Ω–∏–º—É–º 4GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 8GB)
- ‚úÖ **–î–∏—Å–∫:** 20GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 50GB)
- ‚úÖ **–°–µ—Ç—å:** –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
- ‚úÖ **–ü—Ä–∞–≤–∞:** root –∏–ª–∏ sudo –¥–æ—Å—Ç—É–ø

## –°–µ—Ç–µ–≤—ã–µ –ø–æ—Ä—Ç—ã
- **80** - HTTP (–≤–µ–±-—Å–µ—Ä–≤–µ—Ä)
- **443** - HTTPS (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä)
- **5432** - PostgreSQL (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- **9000** - PHP-FPM (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)

## –î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ

### üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Moodle:
- **HTTP:** http://–≤–∞—à-ip-–∞–¥—Ä–µ—Å
- **HTTPS:** https://–≤–∞—à-–¥–æ–º–µ–Ω (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL)

### üîë –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- –î–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `/var/log/moodle-install.log`

### üìÅ –í–∞–∂–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
- **–ö–æ–¥ Moodle:** `/var/www/html/moodle`
- **–î–∞–Ω–Ω—ã–µ:** `/var/moodledata`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `/var/www/html/moodle/config.php`
- **–õ–æ–≥–∏ Nginx:** `/var/log/nginx/`
- **–õ–æ–≥–∏ PHP:** `/var/log/php8.3-fpm.log`

## üì¶ PHP 8.3 –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

### ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è):
- **ctype** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **curl** - HTTP –∫–ª–∏–µ–Ω—Ç (php8.3-curl)
- **dom** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ php8.3-xml
- **gd** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (php8.3-gd)
- **iconv** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **intl** - –ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è (php8.3-intl)
- **json** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **mbstring** - –ú–Ω–æ–≥–æ–±–∞–π—Ç–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ (php8.3-mbstring)
- **pcre** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **simplexml** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ php8.3-xml
- **spl** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **xml** - XML –ø–∞—Ä—Å–µ—Ä (php8.3-xml)
- **zip** - –†–∞–±–æ—Ç–∞ —Å –∞—Ä—Ö–∏–≤–∞–º–∏ (php8.3-zip)
- **pgsql** - PostgreSQL –¥—Ä–∞–π–≤–µ—Ä (php8.3-pgsql)

### üîß –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:
- **openssl** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **soap** - Web services (php8.3-soap)
- **sodium** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3 (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è)
- **tokenizer** - –í—Å—Ç—Ä–æ–µ–Ω–æ –≤ PHP 8.3
- **xmlrpc** - XML-RPC –ø—Ä–æ—Ç–æ–∫–æ–ª (php8.3-xmlrpc)
- **ldap** - LDAP –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (php8.3-ldap)
- **redis** - Redis –∫—ç—à (php8.3-redis)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ troubleshooting

### üö® –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

#### –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ "hard-set in the config.php, unable to change"
```bash
# –≠—Ç–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
# –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∑–∞–¥–∞–Ω—ã –≤ —Ñ–∞–π–ª–µ config.php - —ç—Ç–æ –ù–û–†–ú–ê–õ–¨–ù–û

# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: "The configuration variable is hard-set in the config.php"
# –ü—Ä–∏—á–∏–Ω–∞: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–¥–∞—é—Ç—Å—è –≤ config.php –∏ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

# –†–µ—à–µ–Ω–∏–µ: –≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–¥–∞–Ω—ã –≤ config.php

# –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
sudo nano /var/www/moodle/config.php

# –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ —Ç–∏–ø–∞:
# $CFG->theme = 'boost';
# $CFG->enablecompletion = 1;

# –ò –∏–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å Moodle Cron (–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)
```bash
# –ï—Å–ª–∏ cron —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ –∏ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: "Continuing to check for tasks for XXX more seconds"
# –ò–õ–ò: "Execute scheduled task: Cleanup old sessions" –∏ –∑–∞–≤–∏—Å–∞–µ—Ç

# –ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï (–≤ –Ω–æ–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):
sudo pkill -f "cron.php"
sudo pkill -9 -f "cron.php"

# –†–µ—à–µ–Ω–∏–µ 1: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Ç–∏–ª–∏—Ç—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è cron:
sudo chmod +x manage-cron.sh && sudo ./manage-cron.sh
# –í –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ:
# 3) –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ cron –ø—Ä–æ—Ü–µ—Å—Å—ã
# 1) –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π cron (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

# –†–µ—à–µ–Ω–∏–µ 2: –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/moodle-installation/quick-stop-cron.sh
chmod +x quick-stop-cron.sh
sudo ./quick-stop-cron.sh

# –†–µ—à–µ–Ω–∏–µ 3: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä—É—á–Ω—É—é
# –ù–∞–π—Ç–∏ –≤—Å–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã cron:
ps aux | grep cron.php

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã (–∑–∞–º–µ–Ω–∏—Ç–µ PID –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞):
sudo kill [PID1] [PID2] ...

# –ò–ª–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ:
sudo pkill -f cron.php

# –†–µ—à–µ–Ω–∏–µ 4: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ cron
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª /etc/cron.d/moodle:
sudo nano /etc/cron.d/moodle

# –î–æ–±–∞–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# * * * * * www-data /usr/bin/php /var/www/moodle/admin/cli/cron.php --quiet >/dev/null 2>&1

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å cron —Å–ª—É–∂–±—É:
sudo systemctl restart cron

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
sudo systemctl status cron
```

#### –û—à–∏–±–∫–∞ "max_input_vars –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 5000"
```bash
# –≠—Ç–∞ –æ—à–∏–±–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ Moodle, –µ—Å–ª–∏ PHP –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: "max_input_vars !! [–°–∏—Å—Ç–µ–º–∞] —ç—Ç–æ—Ç —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ–π–¥–µ–Ω"

# –†–µ—à–µ–Ω–∏–µ 1: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è PHP:
sudo ./fix-php-config.sh

# –†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é
sudo nano /etc/php/8.3/fpm/php.ini
# –ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É max_input_vars –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
# max_input_vars = 5000

sudo nano /etc/php/8.3/cli/php.ini  
# –¢–æ–∂–µ —Å–∞–º–æ–µ –¥–ª—è CLI –≤–µ—Ä—Å–∏–∏

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ PHP-FPM:
sudo systemctl restart php8.3-fpm

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É:
php -r "echo 'max_input_vars = ' . ini_get('max_input_vars') . PHP_EOL;"
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: max_input_vars = 5000
```

#### –û—à–∏–±–∫–∞ "Command line scripts must define CLI_SCRIPT"
```bash
# –ï—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ —ç—Ç—É –æ—à–∏–±–∫—É –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ 07-configure-moodle.sh
# –°–∫—Ä–∏–ø—Ç —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä—É—á–Ω—É—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ:
sudo -u postgres psql -d moodle -c "SELECT version();"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Redis:
redis-cli ping
```

#### –û—à–∏–±–∫–∞ "php8.3-fpm.service not found" –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –≤–µ—Ä—Å–∏—è–º–∏ PHP
```bash
# –ù–û–í–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –£—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å PHP 8.4
# –ü—Ä–æ—è–≤–ª–µ–Ω–∏—è: "database driver problem detected", "PGSQL extension is not loaded"
# –ü—Ä–∏—á–∏–Ω–∞: —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ppa:ondrej/php –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç PHP 8.4

# –†–µ—à–µ–Ω–∏–µ 1: –ü–æ–ª–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π PHP - –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
sudo ./fix-php-versions.sh

# –†–µ—à–µ–Ω–∏–µ 2: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
sudo ./02-install-webserver.sh  # –¢–µ–ø–µ—Ä—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å—Ç–∞–≤–∏—Ç —Ç–æ–ª—å–∫–æ PHP 8.3

# –≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—Å—Ç–∏—Ç –≤—Å–µ –≤–µ—Ä—Å–∏–∏ PHP –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç —Ç–æ–ª—å–∫–æ PHP 8.3
# —Å –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –¥–ª—è Moodle

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏:
php --version                    # –î–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å PHP 8.3.x
dpkg -l | grep php8.3           # –°–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ PHP 8.3
dpkg -l | grep -E "php[0-9]" | grep -v php8.3  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–≥–∏—Ö –≤–µ—Ä—Å–∏–π

# –ò–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤–µ—Ä—Å–∏—é PHP –∏ –∏—Å–ø—Ä–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é:
php --version
sudo systemctl start php8.3-fpm  # –∏–ª–∏ –¥—Ä—É–≥—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é –≤–µ—Ä—Å–∏—é
sudo systemctl enable php8.3-fpm

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É PHP-FPM:
sudo ./diagnose-php-fpm.sh
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ PHP —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –¥–ª—è Moodle
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π:
php -m | grep -E "(curl|gd|intl|mbstring|xml|zip|pgsql|soap|sodium)"

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
php -r "
echo 'PHP Version: ' . phpversion() . PHP_EOL;
echo 'Required extensions:' . PHP_EOL;
\$required = ['curl', 'gd', 'intl', 'mbstring', 'xml', 'zip', 'pgsql'];
foreach (\$required as \$ext) {
    echo \$ext . ': ' . (extension_loaded(\$ext) ? 'OK' : 'MISSING') . PHP_EOL;
}
"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π:
sudo apt install -y php8.3-pgsql php8.3-gd php8.3-curl php8.3-mbstring php8.3-xml php8.3-zip php8.3-intl php8.3-soap
sudo systemctl restart php8.3-fpm
```

#### –û—à–∏–±–∫–∞ "database driver problem detected" (PGSQL extension)
```bash
# –ï—Å–ª–∏ PHP —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
sudo ./fix-php-versions.sh  # –≠—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

# –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:
sudo apt install -y php8.3-pgsql
sudo systemctl restart php8.3-fpm
```

#### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
sudo ./fix-config-issues.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
sudo ./diagnose-moodle.sh
```

### üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/php8.3-fpm.log
sudo journalctl -u nginx -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl restart nginx
sudo systemctl restart php8.3-fpm
sudo systemctl restart postgresql
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (–ø–∞–ø–∫–∞ `monitoring-installation`):
- **Grafana:** http://–≤–∞—à-ip:3000 (admin/admin)
- **Prometheus:** http://–≤–∞—à-ip:9090
- **Alertmanager:** http://–≤–∞—à-ip:9093

## üè¢ RTTI –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **–ü—Ä–æ–µ–∫—Ç:** LMS –¥–ª—è –†–µ—Å–ø—É–±–ª–∏–∫–∞–Ω—Å–∫–æ–≥–æ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –¢–µ—Ö–Ω–∏–∫—É–º–∞ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- **–°–µ—Ä–≤–µ—Ä:** lms.rtti.tj
- **GitHub:** https://github.com/cheptura/LMS_Drupal
- **–ê–≤—Ç–æ—Ä:** cheptura

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è
–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ RTTI –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.
