# –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ LMS —Å–∏—Å—Ç–µ–º—ã RTTI
## Moodle 5.0+ + Drupal 11 —Å –æ–±–ª–∞—á–Ω—ã–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º –∏ NAS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: 3.1 (–æ–±–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è Moodle 5.0+ –∏ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫–∏)  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –°–µ–Ω—Ç—è–±—Ä—å 2025  
**–°–µ—Ä–≤–µ—Ä—ã RTTI**: lms.rtti.tj (92.242.60.172), library.rtti.tj (92.242.61.204)

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç **–æ–±–ª–∞–∫–æ-–ø–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥** —Å –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π –≤ –ø—Ä–æ–¥–∞–∫—à–Ω:

1. **–≠—Ç–∞–ø 1**: –ë—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ –æ–±–ª–∞–∫–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–≠—Ç–∞–ø 2**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π  
3. **–≠—Ç–∞–ø 3**: –ú–∏–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–Ω —Å NAS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–Ω (—Å–º. —Ä–∞–∑–¥–µ–ª "–ü—Ä—è–º–∞—è –ø—Ä–æ–¥–∞–∫—à–Ω —É—Å—Ç–∞–Ω–æ–≤–∫–∞").

## üö® –í–∞–∂–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ 3.1

### –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ **–°–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∏**
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- ‚úÖ **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã RTTI –≥–æ—Ç–æ–≤—ã**

### –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- üîß "ERROR: database 'moodle' already exists" - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ—à–∞–µ—Ç—Å—è
- üîß –ù–µ—É–¥–∞—á–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ - –ø–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
- üîß –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ñ–∞–π–ª–æ–≤ - —É–º–Ω–∞—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å
- üîß –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è v5.0+)
- **–ì–æ—Ç–æ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä—ã RTTI**:
  - **lms.rtti.tj (92.242.60.172)**: Moodle 5.0+ + –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
  - **library.rtti.tj (92.242.61.204)**: Drupal 11 –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- **–û–±–ª–∞—á–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã** (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ): 2 –∏–Ω—Å—Ç–∞–Ω—Å–∞ (Ubuntu Server 24.04 LTS)
  - Moodle: 4-8 CPU cores, 16-32GB RAM, 200GB+ SSD
  - Drupal: 4-6 CPU cores, 8-16GB RAM, 500GB+ SSD
- **–ü—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä—ã**: 2 —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö/–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞
  - –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ + NAS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- **NAS —Å–µ—Ä–≤–µ—Ä**: CIFS/SMB 3.0+, –æ—Ç 2TB, RAID 6+

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ–º–µ–Ω–æ–≤
1. **–î–æ–º–µ–Ω—ã RTTI –≥–æ—Ç–æ–≤—ã**:
   - ‚úÖ `lms.rtti.tj` - –¥–ª—è Moodle 5.0+ LMS
   - ‚úÖ `library.rtti.tj` - –¥–ª—è Drupal 11 –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
2. DNS –∑–∞–ø–∏—Å–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã: 92.242.60.172, 92.242.61.204
3. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Let's Encrypt
4. –î–æ–º–µ–Ω—ã —Ä–µ–∑–æ–ª–≤—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## –ú–ï–¢–û–î 1: –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö RTTI (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

### –≠—Ç–∞–ø 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Moodle 5.0+ –Ω–∞ lms.rtti.tj (92.242.60.172)

#### 1.1 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ SSH
ssh root@92.242.60.172
# –∏–ª–∏
ssh root@lms.rtti.tj
```

#### 1.2 –û–±—ã—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Moodle
```bash
# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/cloud-deployment/install-moodle-cloud.sh
chmod +x install-moodle-cloud.sh

# –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
sudo ./install-moodle-cloud.sh
```

#### 1.3 –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞—Ö –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ –æ—à–∏–±–∫—É "ERROR: database 'moodle' already exists":**

##### –í–∞—Ä–∏–∞–Ω—Ç A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
sudo ./install-moodle-cloud.sh cleanup
```

##### –í–∞—Ä–∏–∞–Ω—Ç B: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –°–∫–∞—á–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∏
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/cloud-deployment/reinstall-moodle.sh
chmod +x reinstall-moodle.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫—É (–ø–æ—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
sudo ./reinstall-moodle.sh
```

##### –í–∞—Ä–∏–∞–Ω—Ç C: –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ª—É–∂–±—ã
sudo systemctl stop nginx

# –£–¥–∞–ª–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres psql -c "DROP DATABASE IF EXISTS moodle;"
sudo -u postgres psql -c "DROP USER IF EXISTS moodleuser;"

# –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã
sudo rm -rf /var/www/html/moodle
sudo rm -rf /var/moodledata
sudo rm -f /root/moodle-credentials.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É
sudo ./install-moodle-cloud.sh
```

#### 1.4 –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ–±–ª–∞—á–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PHP 8.2, PostgreSQL 16, Redis 7, Nginx
- ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Moodle 5.0+ (latest stable)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Let's Encrypt –¥–ª—è lms.rtti.tj
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### 1.5 –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–ª—É–∂–±
sudo systemctl status nginx postgresql redis

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
sudo tail -f /var/log/nginx/access.log

# –î–æ—Å—Ç—É–ø –∫ Moodle
# –ë—Ä–∞—É–∑–µ—Ä: https://lms.rtti.tj
# –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤: /root/moodle-admin-credentials.txt
```

### –≠—Ç–∞–ø 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Drupal 11 –Ω–∞ library.rtti.tj (92.242.61.204)

#### 2.1 –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ SSH
ssh root@92.242.61.204
# –∏–ª–∏
ssh root@library.rtti.tj
```

#### 2.2 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Drupal 11
```bash
# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/cloud-deployment/install-drupal-cloud.sh
chmod +x install-drupal-cloud.sh

# –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
sudo ./install-drupal-cloud.sh
```

#### 2.3 –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PHP 8.3 –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ Drupal 11 —á–µ—Ä–µ–∑ Composer
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π (Views, REST API, Search API)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∏—Å–∫–∞ –∏ API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è library.rtti.tj
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### 2.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo systemctl status nginx postgresql

# –î–æ—Å—Ç—É–ø –∫ Drupal
# –ë—Ä–∞—É–∑–µ—Ä: https://library.rtti.tj
# –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤: /root/drupal-admin-credentials.txt
```

### –≠—Ç–∞–ø 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### 3.1 Prometheus + Grafana –Ω–∞ lms.rtti.tj (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ lms.rtti.tj
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/monitoring/install-prometheus-stack.sh
chmod +x install-prometheus-stack.sh
sudo ./install-prometheus-stack.sh
```

**–î–æ—Å—Ç—É–ø –∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É:**
- Prometheus: http://lms.rtti.tj:9090
- Grafana: http://lms.rtti.tj:3000 (admin/admin)
- AlertManager: http://lms.rtti.tj:9093

#### 3.2 –ê–≥–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞ library.rtti.tj
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ library.rtti.tj
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/monitoring/install-monitoring-agents.sh
chmod +x install-monitoring-agents.sh
sudo ./install-monitoring-agents.sh
```

#### 3.3 –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π Zabbix (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ lms.rtti.tj –≤–º–µ—Å—Ç–æ Prometheus
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/monitoring/install-zabbix.sh
chmod +x install-zabbix.sh
sudo ./install-zabbix.sh

# –î–æ—Å—Ç—É–ø: http://lms.rtti.tj/zabbix
```

---

## –ú–ï–¢–û–î 2: –û–±–ª–∞—á–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ –æ–±–ª–∞—á–Ω—ã—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤

#### 1.1 –í—ã–±–æ—Ä –æ–±–ª–∞—á–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- **AWS**: EC2 instances (t3.large –¥–ª—è Moodle, t3.medium –¥–ª—è Drupal)
- **DigitalOcean**: Droplets (4GB+ –¥–ª—è –Ω–∞—á–∞–ª–∞)  
- **Google Cloud**: Compute Engine instances
- **Azure**: Virtual Machines

#### 1.2 –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–ª–∞—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Ubuntu 24.04 LTS
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö —É—Ç–∏–ª–∏—Ç
sudo apt install -y curl wget git unzip htop

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã
sudo timedatectl set-timezone Asia/Dushanbe

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞ (–æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ—Ä—Ç—ã –æ—Ç–∫—Ä–æ—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏)
sudo ufw enable
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
```

### –≠—Ç–∞–ø 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Moodle 5.0+ –≤ –æ–±–ª–∞–∫–µ

```bash
# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/cloud-deployment/install-moodle-cloud.sh
chmod +x install-moodle-cloud.sh

# –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (—Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ)
sudo ./install-moodle-cloud.sh

# –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
sudo ./install-moodle-cloud.sh cleanup
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ–±–ª–∞—á–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PHP 8.2, PostgreSQL 16, Redis 7, Nginx
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Moodle 5.0+ (latest stable)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Let's Encrypt
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±–ª–∞—á–Ω–æ–≥–æ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –≠—Ç–∞–ø 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Drupal 11 –≤ –æ–±–ª–∞–∫–µ

```bash
# –ù–∞ –≤—Ç–æ—Ä–æ–º –æ–±–ª–∞—á–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/cloud-deployment/install-drupal-cloud.sh
chmod +x install-drupal-cloud.sh

# –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
sudo ./install-drupal-cloud.sh
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PHP 8.3 –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ Drupal 11 —á–µ—Ä–µ–∑ Composer
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∏—Å–∫–∞ –∏ API
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- SSL –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CDN (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–ª–∞—á–Ω–æ–π —Å—Ä–µ–¥—ã

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±–µ–∏—Ö —Å–∏—Å—Ç–µ–º:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:**
   - Moodle: https://your-cloud-domain.com
   - Drupal: https://your-library-domain.com

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
   - –°–æ–∑–¥–∞–Ω–∏–µ –∫—É—Ä—Å–∞ –≤ Moodle
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ Drupal
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
   - SSO –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏
   - API —Å–≤—è–∑–∏
---

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏

#### "ERROR: database 'moodle' already exists"
–°–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ.

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```bash
sudo ./install-moodle-cloud.sh cleanup
```

**–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/cloud-deployment/reinstall-moodle.sh
chmod +x reinstall-moodle.sh
sudo ./reinstall-moodle.sh
```

**–†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:**
```bash
sudo -u postgres psql -c "DROP DATABASE IF EXISTS moodle;"
sudo -u postgres psql -c "DROP USER IF EXISTS moodleuser;"
sudo rm -rf /var/www/html/moodle /var/moodledata
sudo rm -f /root/moodle-credentials.txt
sudo ./install-moodle-cloud.sh
```

#### –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ Moodle
**–ü—Ä–æ–±–ª–µ–º–∞**: 404 –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ Moodle 5.0.2
```bash
# –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç fallback URL:
# https://download.moodle.org/download.php/stable500/moodle-latest-500.tgz
# –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
curl -I https://download.moodle.org/download.php/stable500/moodle-latest-500.tgz
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å SSL
sudo certbot certificates

# –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo certbot renew --dry-run

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Nginx
sudo systemctl reload nginx
```

#### –û—à–∏–±–∫–∏ PHP/Nginx
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/php8.2-fpm.log

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–±—ã
sudo systemctl restart nginx php8.2-fpm

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t
sudo php-fpm8.2 -t
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
```bash
# Moodle
sudo chown -R www-data:www-data /var/www/html/moodle
sudo chown -R www-data:www-data /var/moodledata
sudo chmod -R 755 /var/www/html/moodle
sudo chmod -R 777 /var/moodledata

# Drupal
sudo chown -R www-data:www-data /var/www/html/drupal
sudo chmod -R 755 /var/www/html/drupal
sudo chmod -R 777 /var/www/html/drupal/sites/default/files
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo systemctl status postgresql

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL
sudo systemctl restart postgresql

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres psql

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres psql -l

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
sudo -u postgres psql -c "\du"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

#### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU –∏ –ø–∞–º—è—Ç–∏
htop

# –î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
df -h

# –°–≤–æ–±–æ–¥–Ω–∞—è –ø–∞–º—è—Ç—å
free -m

# –°–µ—Ç–µ–≤—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
netstat -tulpn
```

#### –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
```bash
# Nginx –ª–æ–≥–∏
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# PostgreSQL –ª–æ–≥–∏
sudo tail -f /var/log/postgresql/postgresql-16-main.log

# –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
sudo journalctl -f
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª—É–∂–±
```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª—É–∂–±
sudo systemctl status nginx postgresql redis php8.2-fpm

# –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±
sudo systemctl is-enabled nginx postgresql redis php8.2-fpm
```

---

## –ú–ï–¢–û–î 3: –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å NAS

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ NAS —Å–µ—Ä–≤–µ—Ä–∞

#### 1.1 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–¥–µ–ª–æ–≤ NAS
```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ä–∞–∑–¥–µ–ª—ã –Ω–∞ NAS:
# /moodle-files - –¥–ª—è –¥–∞–Ω–Ω—ã—Ö Moodle
# /drupal-files - –¥–ª—è —Ñ–∞–π–ª–æ–≤ Drupal  
# /backups - –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
# /monitoring - –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```

#### 1.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π NAS
```bash
# –ù–∞ NAS —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
# - moodleuser (–¥–æ—Å—Ç—É–ø –∫ /moodle-files, /backups)
# - drupaluser (–¥–æ—Å—Ç—É–ø –∫ /drupal-files, /backups)
# - backupuser (–¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º)
# - monitoruser (–¥–æ—Å—Ç—É–ø –∫ /monitoring)
```

#### 1.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ NAS
```bash
# –¢–µ—Å—Ç CIFS/SMB –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
sudo apt install -y cifs-utils
sudo mkdir /mnt/test
sudo mount -t cifs //NAS_IP/moodle-files /mnt/test -o username=moodleuser,password=***
ls /mnt/test
sudo umount /mnt/test
```

### –≠—Ç–∞–ø 2: –ü—Ä–æ–¥–∞–∫—à–Ω —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Moodle —Å NAS

```bash
# –ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ lms.rtti.tj
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/production-deployment/install-moodle-production.sh
chmod +x install-moodle-production.sh

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ NAS –≤ —Å–∫—Ä–∏–ø—Ç–µ –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ:
export NAS_HOST="your-nas-ip"
export NAS_MOODLE_SHARE="/moodle-files"
export NAS_BACKUP_SHARE="/backups"
export NAS_USER="moodleuser"
export NAS_PASS="your-password"

# –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å NAS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
sudo ./install-moodle-production.sh
```

### –≠—Ç–∞–ø 3: –ü—Ä–æ–¥–∞–∫—à–Ω —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Drupal —Å NAS

```bash
# –ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ library.rtti.tj
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/production-deployment/install-drupal-production.sh
chmod +x install-drupal-production.sh

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö NAS
export NAS_HOST="your-nas-ip"
export NAS_DRUPAL_SHARE="/drupal-files"
export NAS_BACKUP_SHARE="/backups"
export NAS_USER="drupaluser"
export NAS_PASS="your-password"

# –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
sudo ./install-drupal-production.sh
```

### –≠—Ç–∞–ø 4: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ–±–ª–∞–∫–∞

```bash
# –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –æ–±–ª–∞–∫–æ ‚Üí –ø—Ä–æ–¥–∞–∫—à–Ω
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/migration-tools/cloud-to-production.sh
chmod +x cloud-to-production.sh

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏
export CLOUD_MOODLE_HOST="cloud-moodle-ip"
export CLOUD_DRUPAL_HOST="cloud-drupal-ip"
export PROD_MOODLE_HOST="92.242.60.172"
export PROD_DRUPAL_HOST="92.242.61.204"

# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏
sudo ./cloud-to-production.sh
```

---

## üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

### SSO –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É Moodle –∏ Drupal

#### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥—É–ª–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ Moodle
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/moodle-integration/moodle_drupal_integration.php
sudo cp moodle_drupal_integration.php /var/www/html/moodle/local/

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ Drupal
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/moodle-integration/drupal_moodle_integration.module
sudo cp drupal_moodle_integration.module /var/www/html/drupal/web/modules/custom/
```

#### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API –∫–ª—é—á–µ–π
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±—â–µ–≥–æ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
openssl rand -hex 32

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Moodle: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ü–ª–∞–≥–∏–Ω—ã ‚Üí –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Drupal: –†–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Üí –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π
```

### API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

#### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ REST API –≤ Drupal
```bash
# –í–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π REST
sudo -u www-data drush en rest serialization hal jsonapi -y

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
sudo -u www-data drush config:set rest.settings bc_entity_resource_permissions true -y
```

#### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Moodle
```bash
# –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ü–ª–∞–≥–∏–Ω—ã ‚Üí –í–µ–±-—Å–µ—Ä–≤–∏—Å—ã ‚Üí –û–±–∑–æ—Ä
# –í–∫–ª—é—á–∏—Ç—å –≤–µ–±-—Å–µ—Ä–≤–∏—Å—ã ‚Üí –í–∫–ª—é—á–∏—Ç—å –ø—Ä–æ—Ç–æ–∫–æ–ª—ã ‚Üí REST
```

---

## üìã –ü–æ—Å–ª–µ—É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞
```bash
# Moodle —Å–µ—Ä–≤–µ—Ä (lms.rtti.tj)
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp
sudo ufw allow 9090/tcp  # Prometheus
sudo ufw allow 3000/tcp  # Grafana
sudo ufw enable

# Drupal —Å–µ—Ä–≤–µ—Ä (library.rtti.tj)
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp
sudo ufw enable
```

#### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Fail2ban
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö
sudo apt install -y fail2ban

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Nginx
sudo tee /etc/fail2ban/jail.local <<EOF
[nginx-http-auth]
enabled = true
filter = nginx-http-auth
port = http,https
logpath = /var/log/nginx/error.log

[nginx-noscript]
enabled = true
port = http,https
filter = nginx-noscript
logpath = /var/log/nginx/access.log
maxretry = 6

[nginx-badbots]
enabled = true
port = http,https
filter = nginx-badbots
logpath = /var/log/nginx/access.log
maxretry = 2
EOF

sudo systemctl restart fail2ban
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

#### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è Redis
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
redis-cli ping

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Redis
redis-cli monitor
```

#### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PostgreSQL
```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
sudo tee -a /etc/postgresql/16/main/postgresql.conf <<EOF
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
shared_buffers = 256MB
effective_cache_size = 1GB
maintenance_work_mem = 64MB
checkpoint_completion_target = 0.9
wal_buffers = 16MB
default_statistics_target = 100
random_page_cost = 1.1
effective_io_concurrency = 200
EOF

sudo systemctl restart postgresql
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
```bash
# –ù–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/production-deployment/nas-backup.sh
chmod +x nas-backup.sh

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ cron
sudo crontab -e
# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫–∏:
# 0 2 * * * /path/to/nas-backup.sh daily
# 0 3 * * 0 /path/to/nas-backup.sh weekly  
# 0 4 1 * * /path/to/nas-backup.sh monthly
```

#### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ç–∫–∞–ø–æ–≤
```bash
# –°–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤ –Ω–∞ NAS
ls -la //NAS_IP/backups/

# –¢–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (–Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ)
./nas-backup.sh restore latest
```

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### Checklist –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏

#### Moodle (lms.rtti.tj)
- [ ] –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ https://lms.rtti.tj
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –≤–∞–ª–∏–¥–µ–Ω
- [ ] –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫—É—Ä—Å–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
- [ ] –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

#### Drupal (library.rtti.tj)
- [ ] –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ https://library.rtti.tj
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –≤–∞–ª–∏–¥–µ–Ω
- [ ] –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [ ] API –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- [ ] –ê–≥–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–±–æ—Ç–∞—é—Ç

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [ ] SSO –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Å –æ–±–æ–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
- [ ] Grafana –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞—à–±–æ—Ä–¥—ã
- [ ] Alerting –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –§–∞–π—Ä–≤–æ–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö
- [ ] Fail2ban –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –∞—Ç–∞–∫
- [ ] –õ–æ–≥–∏ —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

#### –ë—ç–∫–∞–ø—ã –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- [ ] NAS –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞
- [ ] –ë—ç–∫–∞–ø—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- **GitHub Repository**: https://github.com/cheptura/LMS_Drupal
- **Issues & Bug Reports**: https://github.com/cheptura/LMS_Drupal/issues
- **Technical Requirements**: [technical-requirements.md](technical-requirements.md)
- **Troubleshooting Guide**: [troubleshooting.md](troubleshooting.md)

### –ö–æ–Ω—Ç–∞–∫—Ç—ã RTTI
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: tech@rtti.tj
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã**: admin@rtti.tj  
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: support@rtti.tj

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è

#### –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª—É–∂–±
systemctl status nginx postgresql redis php8.2-fpm

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
df -h

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏
free -m

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
netstat -tulpn | grep -E "(80|443|5432|6379)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
journalctl --since "1 hour ago" | grep -E "(error|ERROR|fail|FAIL)"
```

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É–∂–±–∞–º–∏
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤–µ–±-—Å—Ç–µ–∫–∞
sudo systemctl restart nginx php8.2-fpm

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
sudo systemctl restart postgresql redis

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
sudo certbot renew
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –°–µ–Ω—Ç—è–±—Ä—å 2025  
**–í–µ—Ä—Å–∏—è —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞**: 3.1  
**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: Moodle 5.0+, Drupal 11, Ubuntu 24.04 LTS  
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π NAS:**
   ```bash
   # –ù–∞ NAS (–ø—Ä–∏–º–µ—Ä –¥–ª—è Synology/QNAP)
   # –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: moodleuser, drupaluser, backupuser
   # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –ø–∞–ø–∫–∞–º
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ CIFS/SMB –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
   ```bash
   # –¢–µ—Å—Ç —Å –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–∞
   sudo apt install -y cifs-utils
   sudo mkdir /mnt/test
   sudo mount -t cifs //NAS_IP/moodle-files /mnt/test -o username=moodleuser
   ```

#### 5.2 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–æ–≤

```bash
# –ù–∞ –∫–∞–∂–¥–æ–º –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ
sudo apt update && sudo apt upgrade -y
sudo apt install -y cifs-utils nfs-common curl wget git

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã
sudo timedatectl set-timezone Asia/Dushanbe

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ—á–µ–∫ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è NAS
sudo mkdir -p /mnt/nas
```

### –≠—Ç–∞–ø 6: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

```bash
# –ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –µ–¥–∏–Ω–∞—è –º–∞—à–∏–Ω–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏)
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/migration-tools/cloud-to-production.sh
chmod +x cloud-to-production.sh

# –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º)
sudo ./cloud-to-production.sh
```

**–ü—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤–∫–ª—é—á–∞–µ—Ç:**
1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤ –æ–±–ª–∞—á–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
2. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å—Ä–µ–¥—ã —Å NAS
4. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ Moodle 5.0.2 —Å NAS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
5. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ Drupal 11 —Å NAS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–æ–≤ –∏ SSL
7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
8. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ NAS

---

## –ú–ï–¢–û–î 3: –ü—Ä—è–º–∞—è –ø—Ä–æ–¥–∞–∫—à–Ω —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π)

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ä–∞–∑—É –≤ –ø—Ä–æ–¥–∞–∫—à–Ω, –º–∏–Ω—É—è –æ–±–ª–∞—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### –≠—Ç–∞–ø 7: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Moodle –≤ –ø—Ä–æ–¥–∞–∫—à–Ω —Å NAS

```bash
# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —É—Å—Ç–∞–Ω–æ–≤–∫–∏
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/production-deployment/install-moodle-production.sh
chmod +x install-moodle-production.sh

# –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å NAS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
sudo ./install-moodle-production.sh
```

### –≠—Ç–∞–ø 8: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Drupal –≤ –ø—Ä–æ–¥–∞–∫—à–Ω —Å NAS

```bash
# –ù–∞ –≤—Ç–æ—Ä–æ–º –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ —Ç–æ–º –∂–µ (–µ—Å–ª–∏ —Ä–µ—Å—É—Ä—Å—ã –ø–æ–∑–≤–æ–ª—è—é—Ç)
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/production-deployment/install-drupal-production.sh
chmod +x install-drupal-production.sh

# –ó–∞–ø—É—Å–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å NAS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
sudo ./install-drupal-production.sh
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
wget https://raw.githubusercontent.com/cheptura/LMS_Drupal/main/production-deployment/nas-backup.sh
chmod +x nas-backup.sh
sudo cp nas-backup.sh /opt/

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ cron
sudo crontab -e
```

**–î–æ–±–∞–≤–∏—Ç—å –≤ crontab:**
```cron
# –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã –≤ 2:00
0 2 * * * /opt/nas-backup.sh daily >> /var/log/lms-backup.log 2>&1

# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –±—ç–∫–∞–ø—ã –≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 3:00
0 3 * * 0 /opt/nas-backup.sh weekly >> /var/log/lms-backup.log 2>&1

# –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –±—ç–∫–∞–ø—ã –≤ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ –≤ 4:00
0 4 1 * * /opt/nas-backup.sh monthly >> /var/log/lms-backup.log 2>&1
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏

### SSO –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–í Moodle:**
   ```bash
   cd /var/www/moodle
   # –í–∫–ª—é—á–µ–Ω–∏–µ external authentication
   sudo -u www-data php admin/cli/cfg.php --name=auth --set=manual,external
   ```

2. **–í Drupal:**
   ```bash
   cd /var/www/drupal
   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥—É–ª–µ–π SSO
   sudo -u www-data composer require drupal/external_auth
   sudo -u www-data drush en external_auth -y
   ```

### API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤ Moodle:**
   - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å ‚Üí –†–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Üí –í–µ–±-—Å–µ—Ä–≤–∏—Å—ã
   - –í–∫–ª—é—á–∏—Ç—å –≤–µ–±-—Å–µ—Ä–≤–∏—Å—ã
   - –°–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω –¥–ª—è Drupal

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ REST API –≤ Drupal:**
   ```bash
   sudo -u www-data drush en restui hal serialization -y
   ```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

#### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –î–æ–º–µ–Ω—ã —Ä–µ–∑–æ–ª–≤—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] NAS –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏
- [ ] –§–∞–π—Ä–≤–æ–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

#### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [ ] Moodle 5.0.2 –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
- [ ] Drupal 11 –¥–æ—Å—Ç—É–ø–µ–Ω –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è SSO —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] SSL Grade A/A+ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ ssllabs.com)
- [ ] Fail2Ban –∞–∫—Ç–∏–≤–µ–Ω
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl status nginx php8.2-fpm php8.3-fpm postgresql redis-server

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
sudo tail -f /var/log/nginx/error.log
sudo journalctl -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ NAS
mountpoint /mnt/nas
df -h /mnt/nas

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL
curl -I https://lms.rtti.tj
curl -I https://library.rtti.tj

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres psql -l
```

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
- [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](technical-requirements.md)
- [–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é](deployment-guide.md)
- [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](troubleshooting.md)

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: tech@rtti.tj
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã**: admin@rtti.tj
- **–≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: +992 XX XXX XXXX

---

*–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è Moodle 5.0.2 –∏ Drupal 11 —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±–ª–∞—á–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ NAS –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π. –°–µ–Ω—Ç—è–±—Ä—å 2025.*
