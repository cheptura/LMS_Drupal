#!/bin/bash

# RTTI Drupal - –®–∞–≥ 10: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
# –°–µ—Ä–≤–µ—Ä: storage.omuzgorpro.tj (92.242.61.204)

echo "=== RTTI Drupal - –®–∞–≥ 10: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã ==="
echo "‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏"
echo "üìÖ –î–∞—Ç–∞: $(date)"
echo

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ root
if [ "$EUID" -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å –ø—Ä–∞–≤–∞–º–∏ root"
    exit 1
fi

DRUPAL_DIR="/var/www/drupal"
PHP_VERSION="8.3"
DOMAIN="storage.omuzgorpro.tj"
REPORT_FILE="/root/drupal-final-report.txt"

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
print_success() {
    echo -e "${GREEN}‚úÖ $1${NC}"
}

print_error() {
    echo -e "${RED}‚ùå $1${NC}"
}

print_warning() {
    echo -e "${YELLOW}‚ö†Ô∏è $1${NC}"
}

print_info() {
    echo -e "${BLUE}‚ÑπÔ∏è $1${NC}"
}

print_header() {
    echo -e "\n${BLUE}=== $1 ===${NC}"
}

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞
cat > $REPORT_FILE << EOF
# –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ –û –£–°–¢–ê–ù–û–í–ö–ï DRUPAL LIBRARY
# –°–µ—Ä–≤–µ—Ä: $DOMAIN ($(hostname -I | awk '{print $1}'))
# –î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: $(date)
# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: $(whoami)

EOF

log_result() {
    echo "$1" >> $REPORT_FILE
}

print_header "1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
os_info=$(lsb_release -d | cut -f2)
print_info "–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: $os_info"
log_result "OS: $os_info"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
arch_info=$(uname -m)
print_info "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: $arch_info"
log_result "Architecture: $arch_info"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
uptime_info=$(uptime -p)
print_info "–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: $uptime_info"
log_result "Uptime: $uptime_info"

print_header "2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
ip_address=$(hostname -I | awk '{print $1}')
if [ ! -z "$ip_address" ]; then
    print_success "IP –∞–¥—Ä–µ—Å: $ip_address"
    log_result "‚úÖ IP: $ip_address"
else
    print_error "IP –∞–¥—Ä–µ—Å –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
    log_result "‚ùå IP: not configured"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS —Ä–µ–∑–æ–ª–≤–∏–Ω–≥–∞
if nslookup $DOMAIN > /dev/null 2>&1; then
    resolved_ip=$(nslookup $DOMAIN | awk '/^Address: / { print $2 }' | tail -1)
    print_success "DNS —Ä–µ–∑–æ–ª–≤–∏–Ω–≥: $DOMAIN -> $resolved_ip"
    log_result "‚úÖ DNS: $DOMAIN -> $resolved_ip"
else
    print_warning "DNS —Ä–µ–∑–æ–ª–≤–∏–Ω–≥: $DOMAIN - –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
    log_result "‚ö†Ô∏è DNS: $DOMAIN - not configured"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
print_info "–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ—Ä—Ç–æ–≤:"
declare -A ports=([22]="SSH" [80]="HTTP" [443]="HTTPS" [5432]="PostgreSQL" [6379]="Redis")

for port in "${!ports[@]}"; do
    if netstat -tln | grep -q ":$port "; then
        print_success "–ü–æ—Ä—Ç $port (${ports[$port]}): –æ—Ç–∫—Ä—ã—Ç"
        log_result "‚úÖ Port $port (${ports[$port]}): open"
    else
        print_error "–ü–æ—Ä—Ç $port (${ports[$port]}): –∑–∞–∫—Ä—ã—Ç"
        log_result "‚ùå Port $port (${ports[$port]}): closed"
    fi
done

print_header "3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ (Nginx)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Nginx
if systemctl is-active --quiet nginx; then
    print_success "Nginx: –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚úÖ Nginx: active"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
    nginx_version=$(nginx -v 2>&1 | cut -d/ -f2)
    print_info "–í–µ—Ä—Å–∏—è Nginx: $nginx_version"
    log_result "Nginx version: $nginx_version"
else
    print_error "Nginx: –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚ùå Nginx: inactive"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx
if nginx -t &> /dev/null; then
    print_success "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞"
    log_result "‚úÖ Nginx config: valid"
else
    print_error "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx: —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏"
    log_result "‚ùå Nginx config: invalid"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
if [ -f "/etc/letsencrypt/live/$DOMAIN/fullchain.pem" ]; then
    cert_expiry=$(openssl x509 -enddate -noout -in "/etc/letsencrypt/live/$DOMAIN/fullchain.pem" | cut -d= -f2)
    print_success "SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–∏—Å—Ç–µ–∫–∞–µ—Ç: $cert_expiry)"
    log_result "‚úÖ SSL cert: installed, expires $cert_expiry"
else
    print_warning "SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç: –Ω–µ –Ω–∞–π–¥–µ–Ω"
    log_result "‚ö†Ô∏è SSL cert: not found"
fi

print_header "4. –ü—Ä–æ–≤–µ—Ä–∫–∞ PHP"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ PHP-FPM
if systemctl is-active --quiet php$PHP_VERSION-fpm; then
    print_success "PHP-FPM: –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚úÖ PHP-FPM: active"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ PHP
    php_version=$(php -v | head -1 | cut -d' ' -f2)
    print_info "–í–µ—Ä—Å–∏—è PHP: $php_version"
    log_result "PHP version: $php_version"
else
    print_error "PHP-FPM: –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚ùå PHP-FPM: inactive"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ PHP –º–æ–¥—É–ª–µ–π
print_info "–ü—Ä–æ–≤–µ—Ä–∫–∞ PHP –º–æ–¥—É–ª–µ–π:"
required_modules=("pdo_pgsql" "gd" "curl" "zip" "xml" "mbstring" "opcache" "redis" "memcached")

for module in "${required_modules[@]}"; do
    if php -m | grep -q "^$module$"; then
        print_success "$module: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        log_result "‚úÖ PHP module $module: installed"
    else
        print_error "$module: –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        log_result "‚ùå PHP module $module: missing"
    fi
done

print_header "5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ PostgreSQL
if systemctl is-active --quiet postgresql; then
    print_success "PostgreSQL: –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚úÖ PostgreSQL: active"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏
    pg_version=$(sudo -u postgres psql -c "SELECT version();" | grep "PostgreSQL" | cut -d' ' -f3)
    print_info "–í–µ—Ä—Å–∏—è PostgreSQL: $pg_version"
    log_result "PostgreSQL version: $pg_version"
else
    print_error "PostgreSQL: –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚ùå PostgreSQL: inactive"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
if sudo -u postgres psql -d drupal_library -c "SELECT 1;" &> /dev/null; then
    print_success "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö drupal_library: –¥–æ—Å—Ç—É–ø–Ω–∞"
    log_result "‚úÖ Database drupal_library: accessible"
    
    # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    table_count=$(sudo -u postgres psql -d drupal_library -t -c "SELECT count(*) FROM information_schema.tables WHERE table_schema = 'public';" | tr -d ' ')
    print_info "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü: $table_count"
    log_result "Database tables: $table_count"
    
    db_size=$(sudo -u postgres psql -d drupal_library -t -c "SELECT pg_size_pretty(pg_database_size('drupal_library'));" | tr -d ' ')
    print_info "–†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: $db_size"
    log_result "Database size: $db_size"
else
    print_error "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö drupal_library: –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
    log_result "‚ùå Database drupal_library: inaccessible"
fi

print_header "6. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (Redis & Memcached)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
if systemctl is-active --quiet redis-server; then
    print_success "Redis: –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚úÖ Redis: active"
    
    if redis-cli ping &> /dev/null; then
        print_success "Redis: –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã"
        log_result "‚úÖ Redis: responding"
        
        redis_memory=$(redis-cli info memory | grep "used_memory_human" | cut -d: -f2 | tr -d '\r')
        print_info "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ Redis: $redis_memory"
        log_result "Redis memory: $redis_memory"
    else
        print_error "Redis: –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"
        log_result "‚ùå Redis: not responding"
    fi
else
    print_error "Redis: –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚ùå Redis: inactive"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Memcached
if systemctl is-active --quiet memcached; then
    print_success "Memcached: –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚úÖ Memcached: active"
    
    if echo "stats" | nc localhost 11211 &> /dev/null; then
        print_success "Memcached: –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã"
        log_result "‚úÖ Memcached: responding"
    else
        print_error "Memcached: –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç"
        log_result "‚ùå Memcached: not responding"
    fi
else
    print_error "Memcached: –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚ùå Memcached: inactive"
fi

print_header "7. –ü—Ä–æ–≤–µ—Ä–∫–∞ Drupal"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ Drupal
if [ -d "$DRUPAL_DIR" ] && [ -f "$DRUPAL_DIR/web/index.php" ]; then
    print_success "Drupal —Ñ–∞–π–ª—ã: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    log_result "‚úÖ Drupal files: installed"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ Drupal
    cd $DRUPAL_DIR
    if [ -f "vendor/bin/drush" ]; then
        drupal_version=$(sudo -u www-data vendor/bin/drush status --field=drupal-version 2>/dev/null)
        if [ ! -z "$drupal_version" ]; then
            print_success "–í–µ—Ä—Å–∏—è Drupal: $drupal_version"
            log_result "‚úÖ Drupal version: $drupal_version"
        else
            print_warning "–ù–µ —É–¥–∞–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–µ—Ä—Å–∏—é Drupal"
            log_result "‚ö†Ô∏è Drupal version: unknown"
        fi
    fi
else
    print_error "Drupal —Ñ–∞–π–ª—ã: –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
    log_result "‚ùå Drupal files: not found"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Drupal
if [ -f "$DRUPAL_DIR/web/sites/default/settings.php" ]; then
    print_success "–§–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ Drupal: —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    log_result "‚úÖ Drupal settings: exists"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫
    settings_perms=$(stat -c "%a" "$DRUPAL_DIR/web/sites/default/settings.php")
    if [ "$settings_perms" == "444" ]; then
        print_success "–ü—Ä–∞–≤–∞ –Ω–∞ settings.php: –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ ($settings_perms)"
        log_result "‚úÖ Settings permissions: $settings_perms"
    else
        print_warning "–ü—Ä–∞–≤–∞ –Ω–∞ settings.php: $settings_perms (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 444)"
        log_result "‚ö†Ô∏è Settings permissions: $settings_perms"
    fi
else
    print_error "–§–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ Drupal: –Ω–µ –Ω–∞–π–¥–µ–Ω"
    log_result "‚ùå Drupal settings: not found"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Drupal
cd $DRUPAL_DIR
if sudo -u www-data vendor/bin/drush status &> /dev/null; then
    print_success "Drupal: —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç"
    log_result "‚úÖ Drupal: functional"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π
    print_info "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö –º–æ–¥—É–ª–µ–π:"
    key_modules=("node" "user" "system" "admin_toolbar" "search_api" "redis")
    
    for module in "${key_modules[@]}"; do
        if sudo -u www-data vendor/bin/drush pm:list --status=enabled --format=list | grep -q "^$module$"; then
            print_success "$module: –≤–∫–ª—é—á–µ–Ω"
            log_result "‚úÖ Module $module: enabled"
        else
            print_warning "$module: –Ω–µ –≤–∫–ª—é—á–µ–Ω"
            log_result "‚ö†Ô∏è Module $module: disabled"
        fi
    done
else
    print_error "Drupal: –Ω–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç"
    log_result "‚ùå Drupal: not functional"
fi

print_header "8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Fail2Ban
if systemctl is-active --quiet fail2ban; then
    print_success "Fail2Ban: –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚úÖ Fail2Ban: active"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö IP
    banned_count=$(fail2ban-client status | grep "Number of jail" | cut -d: -f2 | tr -d ' ')
    print_info "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö jail: $banned_count"
    log_result "Fail2Ban jails: $banned_count"
else
    print_error "Fail2Ban: –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚ùå Fail2Ban: inactive"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall
if iptables -L INPUT | grep -q "DROP"; then
    print_success "Firewall: –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
    log_result "‚úÖ Firewall: configured"
else
    print_warning "Firewall: –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
    log_result "‚ö†Ô∏è Firewall: not configured"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ auditd
if systemctl is-active --quiet auditd; then
    print_success "Auditd: –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚úÖ Auditd: active"
else
    print_warning "Auditd: –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω"
    log_result "‚ö†Ô∏è Auditd: inactive"
fi

print_header "9. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã
load_avg=$(uptime | awk -F'load average:' '{print $2}' | sed 's/^[ \t]*//')
print_info "–°—Ä–µ–¥–Ω—è—è –∑–∞–≥—Ä—É–∑–∫–∞: $load_avg"
log_result "Load average: $load_avg"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
memory_usage=$(free -h | grep "Mem:" | awk '{print $3"/"$2" ("int($3/$2*100)"%)";}')
print_info "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏: $memory_usage"
log_result "Memory usage: $memory_usage"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Å–∫–∞
disk_usage=$(df -h /var/www | tail -1 | awk '{print $3"/"$2" ("$5")"}')
print_info "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞: $disk_usage"
log_result "Disk usage: $disk_usage"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
process_count=$(ps aux | wc -l)
print_info "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: $process_count"
log_result "Process count: $process_count"

print_header "10. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP/HTTPS –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP –æ—Ç–≤–µ—Ç–∞
if curl -s -o /dev/null -w "%{http_code}" http://$DOMAIN | grep -q "301\|302"; then
    print_success "HTTP: –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
    log_result "‚úÖ HTTP redirect: working"
else
    print_warning "HTTP: –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ"
    log_result "‚ö†Ô∏è HTTP redirect: not configured"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS –æ—Ç–≤–µ—Ç–∞
https_status=$(curl -s -o /dev/null -w "%{http_code}" https://$DOMAIN 2>/dev/null || echo "000")
if [ "$https_status" == "200" ]; then
    print_success "HTTPS: —Å–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω (–∫–æ–¥ $https_status)"
    log_result "‚úÖ HTTPS: accessible (code $https_status)"
elif [ "$https_status" == "000" ]; then
    print_error "HTTPS: —Å–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–æ—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è)"
    log_result "‚ùå HTTPS: connection error"
else
    print_warning "HTTPS: —Å–∞–π—Ç –æ—Ç–≤–µ—á–∞–µ—Ç —Å –∫–æ–¥–æ–º $https_status"
    log_result "‚ö†Ô∏è HTTPS: code $https_status"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
if [ "$https_status" == "200" ]; then
    response_time=$(curl -s -o /dev/null -w "%{time_total}" https://$DOMAIN 2>/dev/null || echo "timeout")
    print_info "–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${response_time}s"
    log_result "Response time: ${response_time}s"
fi

print_header "11. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ª–æ–≥–æ–≤
log_dirs=("/var/log/nginx" "/var/log/drupal" "/var/log/postgresql")
for log_dir in "${log_dirs[@]}"; do
    if [ -d "$log_dir" ]; then
        log_count=$(find "$log_dir" -name "*.log" | wc -l)
        print_success "–õ–æ–≥–∏ $log_dir: $log_count —Ñ–∞–π–ª–æ–≤"
        log_result "‚úÖ Logs $log_dir: $log_count files"
    else
        print_warning "–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ª–æ–≥–æ–≤ $log_dir: –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
        log_result "‚ö†Ô∏è Log dir $log_dir: not found"
    fi
done

# –ü—Ä–æ–≤–µ—Ä–∫–∞ cron –∑–∞–¥–∞–Ω–∏–π
cron_count=$(crontab -l 2>/dev/null | grep -v "^#" | grep -v "^$" | wc -l)
if [ "$cron_count" -gt 0 ]; then
    print_success "Cron –∑–∞–¥–∞–Ω–∏—è: $cron_count –∞–∫—Ç–∏–≤–Ω—ã—Ö"
    log_result "‚úÖ Cron jobs: $cron_count active"
else
    print_warning "Cron –∑–∞–¥–∞–Ω–∏—è: –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"
    log_result "‚ö†Ô∏è Cron jobs: not configured"
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
maintenance_scripts=("/root/library-maintenance.sh" "/root/drupal-monitor.sh" "/root/drupal-backup.sh" "/root/security-monitor.sh")
for script in "${maintenance_scripts[@]}"; do
    if [ -f "$script" ] && [ -x "$script" ]; then
        print_success "–°–∫—Ä–∏–ø—Ç $(basename $script): —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π"
        log_result "‚úÖ Script $(basename $script): installed"
    else
        print_warning "–°–∫—Ä–∏–ø—Ç $(basename $script): –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π"
        log_result "‚ö†Ô∏è Script $(basename $script): missing or not executable"
    fi
done

print_header "12. –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–¥–∫–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ"

# –ü–æ–¥—Å—á–µ—Ç —É—Å–ø–µ—à–Ω—ã—Ö –∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
success_count=$(grep -c "‚úÖ" $REPORT_FILE)
warning_count=$(grep -c "‚ö†Ô∏è" $REPORT_FILE)
error_count=$(grep -c "‚ùå" $REPORT_FILE)

total_checks=$((success_count + warning_count + error_count))
success_percentage=$((success_count * 100 / total_checks))

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
if [ $error_count -eq 0 ] && [ $warning_count -le 3 ]; then
    installation_status="–û–¢–õ–ò–ß–ù–û–ï"
    status_color=$GREEN
elif [ $error_count -le 2 ] && [ $warning_count -le 5 ]; then
    installation_status="–•–û–†–û–®–ï–ï"
    status_color=$YELLOW
else
    installation_status="–¢–†–ï–ë–£–ï–¢ –í–ù–ò–ú–ê–ù–ò–Ø"
    status_color=$RED
fi

cat >> $REPORT_FILE << EOF

=== –°–í–û–î–ö–ê –ü–†–û–í–ï–†–ö–ò ===

–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–æ–∫: $total_checks
‚úÖ –£—Å–ø–µ—à–Ω–æ: $success_count ($success_percentage%)
‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: $warning_count
‚ùå –û—à–∏–±–∫–∏: $error_count

–°–¢–ê–¢–£–° –£–°–¢–ê–ù–û–í–ö–ò: $installation_status

=== –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò ===

EOF

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
if [ $error_count -gt 0 ]; then
    cat >> $REPORT_FILE << EOF
–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´:
- –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ ($error_count)
- –¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –°–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ

EOF
fi

if [ $warning_count -gt 0 ]; then
    cat >> $REPORT_FILE << EOF
–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø:
- –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã ($warning_count)
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- –°–∏—Å—Ç–µ–º–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–ª—É—á—à–µ–Ω–∞

EOF
fi

cat >> $REPORT_FILE << EOF
–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏ –∏ –æ—à–∏–±–∫–∞–º–∏
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
3. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
4. –û–±–Ω–æ–≤–ª—è–π—Ç–µ Drupal –∏ –º–æ–¥—É–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
5. –ü—Ä–æ–≤–æ–¥–∏—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

=== –ö–û–ù–¢–ê–ö–¢–´ –¢–ï–•–ù–ò–ß–ï–°–ö–û–ô –ü–û–î–î–ï–†–ñ–ö–ò ===
Email: support@omuzgorpro.tj
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: /root/drupal-*-report.txt
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: /root/drupal-monitor.sh
–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ: /root/library-maintenance.sh

=== –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï ===

–î–∞—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏: $(date)
–°–µ—Ä–≤–µ—Ä: $DOMAIN ($(hostname -I | awk '{print $1}'))
–í–µ—Ä—Å–∏—è Drupal: $(cd $DRUPAL_DIR && sudo -u www-data vendor/bin/drush status --field=drupal-version 2>/dev/null || echo "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")
–°—Ç–∞—Ç—É—Å: $installation_status

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!
EOF

print_header "13. –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã"

# –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
print_info "–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏..."
if command -v ab &> /dev/null; then
    ab_result=$(ab -n 10 -c 2 https://$DOMAIN/ 2>/dev/null | grep "Requests per second" | awk '{print $4}')
    if [ ! -z "$ab_result" ]; then
        print_success "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: $ab_result –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫"
        log_result "‚úÖ Performance: $ab_result req/sec"
    fi
else
    print_info "Apache Bench –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
fi

# –¢–µ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
print_info "–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö..."
if cd $DRUPAL_DIR && sudo -u www-data vendor/bin/drush sql:query "SELECT COUNT(*) FROM users;" &> /dev/null; then
    user_count=$(cd $DRUPAL_DIR && sudo -u www-data vendor/bin/drush sql:query "SELECT COUNT(*) FROM users;" --extra=--skip-column-names 2>/dev/null)
    print_success "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: $user_count –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
    log_result "‚úÖ Database test: $user_count users"
else
    print_error "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"
    log_result "‚ùå Database test: connection error"
fi

print_header "14. –°–æ–∑–¥–∞–Ω–∏–µ final checklist"

cat > /root/drupal-checklist.txt << EOF
# –ö–û–ù–¢–†–û–õ–¨–ù–´–ô –°–ü–ò–°–û–ö DRUPAL LIBRARY
# –î–∞—Ç–∞: $(date)

[ ] 1. –°–∏—Å—Ç–µ–º–∞ –∏ —Å–µ—Ç—å
    [ ] –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
    [ ] IP –∞–¥—Ä–µ—Å –Ω–∞–∑–Ω–∞—á–µ–Ω
    [ ] DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
    [ ] –ü–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã (22, 80, 443)

[ ] 2. –í–µ–±-—Å–µ—Ä–≤–µ—Ä
    [ ] Nginx —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω
    [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
    [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
    [ ] –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ö–æ—Å—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω

[ ] 3. PHP
    [ ] PHP-FPM –∑–∞–ø—É—â–µ–Ω
    [ ] –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
    [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
    [ ] OPcache –Ω–∞—Å—Ç—Ä–æ–µ–Ω

[ ] 4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    [ ] PostgreSQL –∑–∞–ø—É—â–µ–Ω
    [ ] –ë–∞–∑–∞ drupal_library —Å–æ–∑–¥–∞–Ω–∞
    [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å drupaluser –Ω–∞—Å—Ç—Ä–æ–µ–Ω
    [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

[ ] 5. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
    [ ] Redis –∑–∞–ø—É—â–µ–Ω –∏ –æ—Ç–≤–µ—á–∞–µ—Ç
    [ ] Memcached –∑–∞–ø—É—â–µ–Ω
    [ ] Drupal –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –∫—ç—à—É
    [ ] APCu —Ä–∞–±–æ—Ç–∞–µ—Ç

[ ] 6. Drupal
    [ ] –§–∞–π–ª—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
    [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
    [ ] –ú–æ–¥—É–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã
    [ ] –¢–µ–º—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
    [ ] –ö–æ–Ω—Ç–µ–Ω—Ç-—Ç–∏–ø—ã —Å–æ–∑–¥–∞–Ω—ã

[ ] 7. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
    [ ] Fail2Ban –Ω–∞—Å—Ç—Ä–æ–µ–Ω
    [ ] Firewall –∞–∫—Ç–∏–≤–µ–Ω
    [ ] SSL —Ä–∞–±–æ—Ç–∞–µ—Ç
    [ ] –ü—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
    [ ] –ê—É–¥–∏—Ç –≤–∫–ª—é—á–µ–Ω

[ ] 8. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
    [ ] –°–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
    [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
    [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
    [ ] –°–∫—Ä–∏–ø—Ç—ã –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è

[ ] 9. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
    [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
    [ ] –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    [ ] –†–æ—Ç–∞—Ü–∏—è –∞—Ä—Ö–∏–≤–æ–≤
    [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

[ ] 10. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
    [ ] –°–∂–∞—Ç–∏–µ –≤–∫–ª—é—á–µ–Ω–æ
    [ ] –°—Ç–∞—Ç–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
    [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
EOF

echo
echo -e "${status_color}=== –§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢ ===${NC}"
echo -e "${BLUE}–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–æ–∫:${NC} $total_checks"
echo -e "${GREEN}‚úÖ –£—Å–ø–µ—à–Ω–æ:${NC} $success_count ($success_percentage%)"
echo -e "${YELLOW}‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:${NC} $warning_count"
echo -e "${RED}‚ùå –û—à–∏–±–∫–∏:${NC} $error_count"
echo
echo -e "${status_color}–°–¢–ê–¢–£–° –£–°–¢–ê–ù–û–í–ö–ò: $installation_status${NC}"
echo
print_info "–ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: $REPORT_FILE"
print_info "–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫: /root/drupal-checklist.txt"
echo
if [ "$installation_status" == "–û–¢–õ–ò–ß–ù–û–ï" ]; then
    print_success "üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!"
    print_success "üåê –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: https://$DOMAIN"
    print_success "üîß –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: https://$DOMAIN/admin"
elif [ "$installation_status" == "–•–û–†–û–®–ï–ï" ]; then
    print_success "‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –∑–∞–º–µ—á–∞–Ω–∏—è–º–∏"
    print_info "üìã –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –æ—Ç—á–µ—Ç–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è"
    print_success "üåê –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: https://$DOMAIN"
else
    print_warning "‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
    print_warning "üîß –£—Å—Ç—Ä–∞–Ω–∏—Ç–µ –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º"
    print_info "üìã –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ –æ—Ç—á–µ—Ç–µ: $REPORT_FILE"
fi

echo
print_header "–ü–û–õ–ï–ó–ù–´–ï –ö–û–ú–ê–ù–î–´"
print_info "–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã: /root/drupal-monitor.sh status"
print_info "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: /root/library-maintenance.sh stats"
print_info "–°—Ç–∞—Ç—É—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: /root/security-monitor.sh status"
print_info "–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏: /root/drupal-backup.sh"
print_info "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞: /root/library-maintenance.sh reindex"

echo
print_success "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Drupal Library RTTI –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo
