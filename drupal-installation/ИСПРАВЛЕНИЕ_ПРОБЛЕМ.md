# Инструкция по исправлению проблем Drupal в WSL

## Проблемы после установки:
1. ❌ Nginx: не активен  
2. ❌ Конфигурация Nginx: содержит ошибки (дублирующиеся gzip директивы)
3. ❌ Порт 80 (HTTP): закрыт
4. ❌ Порт 443 (HTTPS): закрыт  
5. ❌ opcache: не установлен

## Решение:

### Шаг 1: Войдите в WSL
В PowerShell выполните:
```powershell
wsl
```

### Шаг 2: Перейдите в директорию со скриптами
```bash
cd /mnt/g/LMS_Drupal/drupal-installation/
```

### Шаг 3: Сделайте скрипты исполняемыми
```bash
sudo chmod +x fix-*.sh
```

### Шаг 4: Выполните комплексное исправление
```bash
sudo ./fix-all-issues.sh
```

ИЛИ выполните исправления по отдельности:

#### Исправить проблему с gzip в Nginx:
```bash
sudo ./fix-nginx-gzip.sh
```

#### Установить и настроить OPcache:
```bash
sudo ./fix-opcache.sh
```

### Шаг 5: Проверьте результаты
```bash
# Проверка конфигурации Nginx
sudo nginx -t

# Статус сервисов
sudo systemctl status nginx php8.3-fpm postgresql redis

# Открытые порты
sudo netstat -tlnp | grep ':80\|:443\|:5432\|:6379'

# OPcache
php -m | grep -i opcache
```

### Шаг 6: Тест веб-сервера
```bash
# HTTP тест
curl -I http://localhost

# HTTPS тест (если есть сертификат)
curl -I -k https://localhost

# Тест Drupal сайта
curl -I http://storage.omuzgorpro.tj
```

## Дополнительные команды для диагностики:

### Просмотр логов ошибок:
```bash
# Nginx ошибки
sudo tail -f /var/log/nginx/error.log

# PHP-FPM ошибки  
sudo tail -f /var/log/php8.3-fpm.log

# Системные логи
sudo journalctl -u nginx -f
sudo journalctl -u php8.3-fpm -f
```

### Перезапуск сервисов:
```bash
sudo systemctl restart php8.3-fpm
sudo systemctl restart nginx
sudo systemctl restart postgresql
sudo systemctl restart redis
```

### Проверка файрвола:
```bash
# Статус UFW
sudo ufw status

# Разрешить порты если нужно
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
```

## Ожидаемый результат после исправления:
- ✅ Nginx: активен
- ✅ Конфигурация Nginx: корректна  
- ✅ Порт 80 (HTTP): открыт
- ✅ Порт 443 (HTTPS): открыт
- ✅ opcache: установлен
- ✅ Сайт Drupal доступен

## В случае проблем:
1. Проверьте логи: `/var/log/drupal-fix-*.log`
2. Убедитесь что WSL запущен с правами администратора
3. Проверьте что все сервисы установлены корректно
4. Обратитесь к детальным логам ошибок

## Контакты для поддержки:
- Проект: RTTI Drupal Library
- Сервер: storage.omuzgorpro.tj (92.242.61.204)
- Версия: Drupal 11 LTS
