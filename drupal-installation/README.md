# Drupal Installation Scripts

## –û–ø–∏—Å–∞–Ω–∏–µ
–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Drupal 11 Digital Library –Ω–∞ Ubuntu 24.04 LTS —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏ –¥–ª—è RTTI.

## üöÄ QUICK_INSTALL
```bash
# –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –∑–∞–º–µ–Ω–æ–π —Ñ–∞–π–ª–æ–≤ (–æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π)
cd /tmp
rm -rf LMS_Drupal 2>/dev/null || true
git clone https://github.com/cheptura/LMS_Drupal.git
cd LMS_Drupal/drupal-installation
sudo chmod +x install-drupal.sh && sudo ./install-drupal.sh
```

‚ö†Ô∏è **–í–ê–ñ–ù–û –¥–ª—è SSL:** –ï—Å–ª–∏ –ø–æ–ª—É—á–∏—Ç–µ –æ—à–∏–±–∫—É –ª–∏–º–∏—Ç–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Let's Encrypt ("too many certificates"), —Å–º. —Ä–∞–∑–¥–µ–ª troubleshooting ‚Üí "–û—à–∏–±–∫–∞ –ª–∏–º–∏—Ç–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ Let's Encrypt"

‚ö†Ô∏è **–í–ê–ñ–ù–û –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π:** –ï—Å–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ "location directive is not allowed here", –æ–±–Ω–æ–≤–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
cd /tmp/LMS_Drupal && git pull --force origin main
```

### üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
```bash
# –ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —É–∂–µ —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω
cd /tmp/LMS_Drupal
git reset --hard HEAD
git pull --force origin main
cd drupal-installation
sudo chmod +x *.sh
```

## –°–æ—Å—Ç–∞–≤ —Å–∫—Ä–∏–ø—Ç–æ–≤

### üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
1. **01-prepare-system.sh** - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã Ubuntu
2. **02-install-webserver.sh** - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
3. **03-install-database.sh** - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL 16 –°–£–ë–î
4. **04-install-cache.sh** - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Redis
5. **05-configure-ssl.sh** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
6. **06-install-drupal.sh** - –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Drupal 11 LTS
7. **07-configure-drupal.sh** - –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Drupal (–æ–±–ª–µ–≥—á–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
8. **08-post-install.sh** - –ü–æ—Å—Ç-—É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–æ–±–ª–µ–≥—á–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
9. **09-security.sh** - –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–æ–±–ª–µ–≥—á–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
10. **10-final-check.sh** - –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:
- **update-drupal.sh** - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Drupal —á–µ—Ä–µ–∑ Composer –∏ Drush
- **backup-drupal.sh** - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- **restore-drupal.sh** - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π —Å –∏–º–ø–æ—Ä—Ç–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- **diagnose-drupal.sh** - –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã Drupal

### üìã –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:
- **install-drupal.sh** - –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### üîÑ –í–µ—Ä—Å–∏–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤:
- **–û–±–ª–µ–≥—á–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - –±—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- **–ü–æ–ª–Ω—ã–µ –≤–µ—Ä—Å–∏–∏** (—Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏) - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º:
  - `07-configure-drupal-full.sh.backup` - –ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  - `08-post-install-full.sh.backup` - –ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å–æ —Å–∫—Ä–∏–ø—Ç–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
  - `09-security-full.sh.backup` - –ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å Fail2Ban –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é

## –ü–æ—ç—Ç–∞–ø–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å –∑–∞–º–µ–Ω–æ–π —Ñ–∞–π–ª–æ–≤
cd /tmp
rm -rf LMS_Drupal 2>/dev/null || true
git clone https://github.com/cheptura/LMS_Drupal.git
cd /tmp/LMS_Drupal/drupal-installation
sudo chmod +x *.sh

# –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
sudo ./01-prepare-system.sh      # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã Ubuntu
sudo ./02-install-webserver.sh   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx –∏ PHP
sudo ./03-install-database.sh    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL 16
sudo ./04-install-cache.sh       # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Redis
sudo ./05-configure-ssl.sh       # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
sudo ./06-install-drupal.sh      # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Drupal 11
sudo ./07-configure-drupal.sh    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Drupal
sudo ./08-post-install.sh        # –ü–æ—Å—Ç-—É—Å—Ç–∞–Ω–æ–≤–æ—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
sudo ./09-security.sh            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
sudo ./10-final-check.sh         # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```

## –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∫—Ä–∏–ø—Ç `10-final-check.sh` –ø—Ä–æ–≤–æ–¥–∏—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:

### ‚úÖ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:
- **–°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: –û–°, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
- **–°–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: IP-–∞–¥—Ä–µ—Å, DNS, –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã (80, 443, 22, 5432, 6379)
- **–í–µ–±-—Å–µ—Ä–≤–µ—Ä**: —Å—Ç–∞—Ç—É—Å Nginx, –≤–µ—Ä—Å–∏—è, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- **PHP**: —Å—Ç–∞—Ç—É—Å PHP-FPM, –≤–µ—Ä—Å–∏—è, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥—É–ª–∏
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: —Å—Ç–∞—Ç—É—Å PostgreSQL, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, —Ä–∞–∑–º–µ—Ä –ë–î
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: —Å—Ç–∞—Ç—É—Å Redis –∏ Memcached, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- **Drupal**: —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –º–æ–¥—É–ª–∏, —Ç–µ–º—ã, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

#### –ï—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç PHP OPcache:
```bash
sudo apt install php8.3-opcache
sudo systemctl restart php8.3-fpm
sudo systemctl restart nginx
```

#### –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º:
```bash
sudo certbot renew --dry-run
sudo systemctl reload nginx
```

#### –ï—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
```bash
sudo systemctl restart redis-server
sudo systemctl status redis-server
```

## –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

### üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```bash
sudo ./diagnose-drupal.sh  # –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
systemctl status nginx postgresql php8.3-fpm  # –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
drush status  # –°—Ç–∞—Ç—É—Å Drupal —á–µ—Ä–µ–∑ Drush
```

### üíæ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
sudo ./backup-drupal.sh    # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞ —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
# –ë—ç–∫–∞–ø—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ /var/backups/drupal/
```

### üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```bash
sudo ./update-drupal.sh    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Drupal —á–µ—Ä–µ–∑ Composer
drush updatedb  # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
drush cache:rebuild  # –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
```

### üîß –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
sudo ./restore-drupal.sh /path/to/backup.tar.gz  # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
```

### üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è–º–∏ —á–µ—Ä–µ–∑ Drush
```bash
drush pm:list           # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
drush pm:enable module  # –í–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª—è
drush pm:uninstall module  # –£–¥–∞–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è
drush config:export     # –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
drush config:import     # –ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

## –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- ‚úÖ **–û–°:** Ubuntu 24.04 LTS
- ‚úÖ **RAM:** –ú–∏–Ω–∏–º—É–º 4GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 8GB)
- ‚úÖ **–î–∏—Å–∫:** 20GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 50GB)
- ‚úÖ **–°–µ—Ç—å:** –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞–∫–µ—Ç–æ–≤
- ‚úÖ **–ü—Ä–∞–≤–∞:** root –∏–ª–∏ sudo –¥–æ—Å—Ç—É–ø
- ‚úÖ **PHP:** 8.3+ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ (gd, curl, dom, simplexml, etc.)

## –°–µ—Ç–µ–≤—ã–µ –ø–æ—Ä—Ç—ã
- **80** - HTTP (–≤–µ–±-—Å–µ—Ä–≤–µ—Ä)
- **443** - HTTPS (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä)
- **5432** - PostgreSQL (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- **9000** - PHP-FPM (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)

## –î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ

### üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Drupal:
- **HTTP:** http://storage.omuzgorpro.tj
- **HTTPS:** https://storage.omuzgorpro.tj (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL)
- **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:** /admin

### üë§ –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- –î–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Ü–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `/var/log/drupal-install.log`

### üìÅ –í–∞–∂–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
- **–ö–æ–¥ Drupal:** `/var/www/drupal`
- **–§–∞–π–ª—ã —Å–∞–π—Ç–∞:** `/var/www/drupal/web/sites/default/files`
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `/var/www/drupal/config/sync`
- **Composer:** `/var/www/drupal/composer.json`
- **–õ–æ–≥–∏ Nginx:** `/var/log/nginx/`
- **–õ–æ–≥–∏ PHP:** `/var/log/php8.3-fpm.log`

## –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ Digital Library
- **Media Library** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞–º–∏
- **Views** - –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –∏ –∫–∞—Ç–∞–ª–æ–≥–æ–≤
- **Taxonomy** - –°–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
- **Search API** - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫
- **Pathauto** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ URL
- **Metatag** - SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **Admin Toolbar** - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
- **Entity Reference** - –°–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ troubleshooting

### üö® –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### –û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx
```bash
# –ï—Å–ª–∏ nginx -t –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞:
sudo nginx -t                                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -T                                    # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "location directive is not allowed here":
# –û–±–Ω–æ–≤–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏:
cd /tmp/LMS_Drupal && git pull --force origin main
cd drupal-installation && sudo chmod +x *.sh

# –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ drupal-static.conf (—Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏):
sudo rm -f /etc/nginx/conf.d/drupal-static.conf  # –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
sudo systemctl reload nginx                      # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ Nginx
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å PHP –≤–µ—Ä—Å–∏—è–º–∏
```bash
# –í–ê–ñ–ù–û: –°–∫—Ä–∏–ø—Ç—ã —Ç–µ–ø–µ—Ä—å –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è PHP
# –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å PHP 8.4 –≤–º–µ—Å—Ç–æ PHP 8.3:

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏:
php --version                    # –î–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å PHP 8.3.x
dpkg -l | grep php8.3           # –°–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ PHP 8.3
dpkg -l | grep -E "php[0-9]" | grep -v php8.3  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—Ä—É–≥–∏—Ö –≤–µ—Ä—Å–∏–π

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π:
sudo ./02-install-webserver.sh  # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å—Ç–∞–≤–∏—Ç —Ç–æ–ª—å–∫–æ PHP 8.3
```

#### –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç PHP OPcache (–≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ OPcache –¥–ª—è PHP 8.3:
sudo apt update
sudo apt install php8.3-opcache
sudo systemctl restart php8.3-fpm
sudo systemctl restart nginx

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
php -m | grep -i opcache        # –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å OPcache –≤ —Å–ø–∏—Å–∫–µ
php --ini | grep opcache        # –ü–æ–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

#### –ü—Ä–æ–±–ª–µ–º—ã —Å Redis –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
```bash
# –ï—Å–ª–∏ Drupal –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "NOAUTH Authentication required":
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Redis –≤ settings.php:
sudo grep -A5 "redis.connection" /var/www/drupal/web/sites/default/settings.php

# 2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–∞—Ä–æ–ª—å Redis –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:
redis-cli -a "RedisRTTI2024!" ping  # –î–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å PONG

# 3. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è, –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
sudo ./04-install-cache.sh
```

#### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/php8.3-fpm.log
drush watchdog:show  # –õ–æ–≥–∏ Drupal

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl restart nginx
sudo systemctl restart php8.3-fpm
sudo systemctl restart postgresql

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ Drupal
drush cache:rebuild
drush cache:clear
```

## Composer –∫–æ–º–∞–Ω–¥—ã
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤
composer update

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è
composer require 'drupal/module_name'

# –£–¥–∞–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è
composer remove drupal/module_name

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
composer audit
```
- **Database**: PostgreSQL 16
- **Web Server**: Nginx 1.24+
- **Cache**: Redis 7+
- **SSL**: Let's Encrypt

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **CPU**: 4+ cores (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 6)
- **RAM**: 8GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 16GB)
- **Storage**: 500GB+ SSD (–¥–ª—è –º—É–ª—å—Ç–∏–º–µ–¥–∏–∞)
- **Network**: 1Gbps

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```
/var/www/drupal/               # Drupal —Ñ–∞–π–ª—ã
/var/drupalfiles/              # –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã
/root/drupal-credentials.txt   # –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–∞
/etc/nginx/sites-available/    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
/etc/php/8.3/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PHP
```

## üîë –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–∞

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤:
- `/root/drupal-admin-credentials.txt` - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- `/root/drupal-db-credentials.txt` - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- URL: https://storage.omuzgorpro.tj
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: admin
- –ü–∞—Ä–æ–ª—å: RTTIDrupal2024!

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª—É–∂–±
systemctl status nginx
systemctl status postgresql
systemctl status redis-server
systemctl status php8.3-fpm

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∞–π—Ç–∞
curl -I https://storage.omuzgorpro.tj

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
tail -f /var/log/nginx/error.log
```

### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `./10-final-check.sh` –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç:

**‚úÖ –£—Å–ø–µ—à–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∫–∞–∂–µ—Ç:**
- –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∞–∫—Ç–∏–≤–Ω—ã (Nginx, PHP-FPM, PostgreSQL, Redis)
- –ü–æ—Ä—Ç—ã 80, 443, 22, 5432, 6379 –æ—Ç–∫—Ä—ã—Ç—ã
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç ~97 —Ç–∞–±–ª–∏—Ü Drupal
- –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ PHP –º–æ–¥—É–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- Drupal –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã

**‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**
- `‚ùå opcache: –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω` - –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–º–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Let's Encrypt

**üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏:**
- –°–µ—Ä–≤–∏—Å—ã –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- Drupal –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ Nginx –∏ PHP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### Drush CLI
```bash
cd /var/www/drupal
vendor/bin/drush status
vendor/bin/drush cache:rebuild
vendor/bin/drush user:login admin
vendor/bin/drush pm:enable module_name
```

### Composer
```bash
cd /var/www/drupal
composer require drupal/module_name
composer update
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è
```bash
./update-drupal.sh          # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Drupal
./update-system.sh          # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
./backup-drupal.sh          # –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
./restore-drupal.sh         # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
```

## üìö –ú–æ–¥—É–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

### –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
- **Book** - –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–Ω–∏–≥ –≤ –∏–µ—Ä–∞—Ä—Ö–∏—é
- **Taxonomy** - –°–∏—Å—Ç–µ–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ç–µ–≥–æ–≤
- **Search** - –ü–æ–∏—Å–∫ –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É
- **Media** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º—É–ª—å—Ç–∏–º–µ–¥–∏–∞
- **Views** - –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **File** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
```bash
cd /var/www/drupal
composer require drupal/facets              # –§–∞—Å–µ—Ç–Ω—ã–π –ø–æ–∏—Å–∫
composer require drupal/search_api          # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
composer require drupal/pdf                 # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PDF
composer require drupal/backup_migrate      # –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
vendor/bin/drush pm:enable facets search_api pdf backup_migrate
```

## üé® –¢–µ–º—ã

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Ç–µ–º—ã
```bash
cd /var/www/html/drupal
composer require drupal/bootstrap5
vendor/bin/drush theme:enable bootstrap5
vendor/bin/drush config:set system.theme default bootstrap5
```

## üîç –ü–æ–∏—Å–∫ –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∏—Å–∫–∞
```bash
# –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ search_api
vendor/bin/drush search-api:index
vendor/bin/drush search-api:reset-tracker
```

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `/root/drupal-db-credentials.txt`
2. **403 Forbidden** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
3. **500 Error** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PHP –∏ Nginx
4. **Composer –æ—à–∏–±–∫–∏** - –æ—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à: `composer clear-cache`

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
./diagnose-drupal.sh         # –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
./fix-permissions.sh         # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤
./reset-drupal.sh           # –°–±—Ä–æ—Å –∫ –Ω–∞—á–∞–ª—å–Ω—ã–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
```

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤
sudo chown -R www-data:www-data /var/www/html/drupal
sudo chmod -R 755 /var/www/html/drupal
sudo chmod -R 777 /var/www/html/drupal/web/sites/default/files
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
```bash
cd ../monitoring-installation
sudo ./install-monitoring.sh
```

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Moodle

–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Moodle LMS:
```bash
./setup-moodle-integration.sh
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **GitHub**: https://github.com/cheptura/LMS_Drupal/issues
- **Email**: admin@omuzgorpro.tj
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [RTTI LMS Wiki](https://github.com/cheptura/LMS_Drupal/wiki)
- **Drupal.org**: https://www.drupal.org/docs

---

**–í–µ—Ä—Å–∏—è**: 1.0  
**–î–∞—Ç–∞**: –°–µ–Ω—Ç—è–±—Ä—å 2025  
**–ê–≤—Ç–æ—Ä**: RTTI Development Team
